<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.594">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>AutoScore: An Interpretable Machine Learning-Based Automatic Clinical Score Generator - 8&nbsp; AutoScore-ShapleyVIC for binary outcomes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06-autoscore_ordinal.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="custom.css">
</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">AutoScore-ShapleyVIC for binary outcomes</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">AutoScore: An Interpretable Machine Learning-Based Automatic Clinical Score Generator</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">AutoScore Introduction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-related_papers.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Related Published papers</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./011Installation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Package Installation and import</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-desc_analysis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Descriptive analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-data_processing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data processing and checking</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-autoscore.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">AutoScore for binary outcomes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-autoscore_survival.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">AutoScore for survival outcomes (AutoScore-Survival)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-autoscore_ordinal.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">AutoScore for ordinal outcomes (AutoScore-Ordinal)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-autoscore_shapleyvic.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">AutoScore-ShapleyVIC for binary outcomes</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#step-1-prepare-training-validation-and-test-datasets" id="toc-step-1-prepare-training-validation-and-test-datasets" class="nav-link active" data-scroll-target="#step-1-prepare-training-validation-and-test-datasets"> <span class="header-section-number">8.1</span> Step 1: Prepare training, validation, and test datasets</a></li>
  <li><a href="#step-2-variable-ranking-from-shapleyvic-analysis-of-nearly-optimal-models" id="toc-step-2-variable-ranking-from-shapleyvic-analysis-of-nearly-optimal-models" class="nav-link" data-scroll-target="#step-2-variable-ranking-from-shapleyvic-analysis-of-nearly-optimal-models"> <span class="header-section-number">8.2</span> Step 2: Variable ranking from ShapleyVIC analysis of nearly optimal models</a>
  <ul class="collapse">
  <li><a href="#install-shapleyvic-package-from-github" id="toc-install-shapleyvic-package-from-github" class="nav-link" data-scroll-target="#install-shapleyvic-package-from-github"> <span class="header-section-number">8.2.1</span> Install ShapleyVIC package from GitHub</a></li>
  <li><a href="#load-r-packages" id="toc-load-r-packages" class="nav-link" data-scroll-target="#load-r-packages"> <span class="header-section-number">8.2.2</span> Load R packages</a></li>
  <li><a href="#train-the-optimal-logistic-regression-model-and-check-for-colinearity" id="toc-train-the-optimal-logistic-regression-model-and-check-for-colinearity" class="nav-link" data-scroll-target="#train-the-optimal-logistic-regression-model-and-check-for-colinearity"> <span class="header-section-number">8.2.3</span> Train the optimal logistic regression model and check for colinearity</a></li>
  <li><a href="#generate-a-random-set-of-350-nearly-optimal-models" id="toc-generate-a-random-set-of-350-nearly-optimal-models" class="nav-link" data-scroll-target="#generate-a-random-set-of-350-nearly-optimal-models"> <span class="header-section-number">8.2.4</span> Generate a random set of 350 nearly optimal models</a></li>
  <li><a href="#compute-shapleyvic-values-from-nearly-optimal-models" id="toc-compute-shapleyvic-values-from-nearly-optimal-models" class="nav-link" data-scroll-target="#compute-shapleyvic-values-from-nearly-optimal-models"> <span class="header-section-number">8.2.5</span> Compute ShapleyVIC values from nearly optimal models</a></li>
  <li><a href="#variable-important-analysis-using-shapleyvic-values" id="toc-variable-important-analysis-using-shapleyvic-values" class="nav-link" data-scroll-target="#variable-important-analysis-using-shapleyvic-values"> <span class="header-section-number">8.2.6</span> Variable important analysis using ShapleyVIC values</a></li>
  <li><a href="#generate-ensemble-variable-ranking-from-shapleyvic" id="toc-generate-ensemble-variable-ranking-from-shapleyvic" class="nav-link" data-scroll-target="#generate-ensemble-variable-ranking-from-shapleyvic"> <span class="header-section-number">8.2.7</span> Generate ensemble variable ranking from ShapleyVIC</a></li>
  </ul></li>
  <li><a href="#step-3-model-development-using-shapleyvic-based-ranking-and-autoscore-workflow" id="toc-step-3-model-development-using-shapleyvic-based-ranking-and-autoscore-workflow" class="nav-link" data-scroll-target="#step-3-model-development-using-shapleyvic-based-ranking-and-autoscore-workflow"> <span class="header-section-number">8.3</span> Step 3: Model development using ShapleyVIC-based ranking and AutoScore workflow</a>
  <ul class="collapse">
  <li><a href="#prepare-variable-ranking-list-for-autoscore" id="toc-prepare-variable-ranking-list-for-autoscore" class="nav-link" data-scroll-target="#prepare-variable-ranking-list-for-autoscore"> <span class="header-section-number">8.3.1</span> Prepare variable ranking list for AutoScore</a></li>
  <li><a href="#select-the-best-model-with-parsimony-plot-autoscore-modules-234" id="toc-select-the-best-model-with-parsimony-plot-autoscore-modules-234" class="nav-link" data-scroll-target="#select-the-best-model-with-parsimony-plot-autoscore-modules-234"> <span class="header-section-number">8.3.2</span> Select the best model with parsimony plot (AutoScore Modules 2+3+4)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="top" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">AutoScore-ShapleyVIC for binary outcomes</span></span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p><a href="./04-autoscore.html#top">Chapter 5</a> described the AutoScore framework for binary outcomes, using the random forest or AUC-based approach to rank and select variables. This chapter describes an integrated AutoScore-ShapleyVIC framework that uses Shapley variable importance cloud (ShapleyVIC), a recently developed interpretable machine learning approach, for interpretable and robust variable ranking, and the subsequent AutoScore pipelines (<code>AutoScore_parsimony()</code>, <code>AutoScore_weighting()</code>, <code>AutoScore_fine_tuning()</code> and <code>AutoScore_testing()</code>) to develop sparse clinical risk scores.</p>
<p>In this chapter, we demonstrate the use of AutoScore-ShapleyVIC using the same simulated dataset as in <a href="./04-autoscore.html#top">Chapter 5, Demo 1</a>, focusing on the variable ranking step using ShapleyVIC and the difference in the resulting parsimony plot.</p>
<p>Cite the following papers for AutoScore-ShapleyVIC:</p>
<p>Ning Y, Ong ME, Chakraborty B, Goldstein BA, Ting DS, Vaughan R, Liu N. Shapley variable importance cloud for interpretable machine learning. <em>Patterns</em> 2022 (<a href="https://doi.org/10.1016/j.patter.2022.100452" class="uri">https://doi.org/10.1016/j.patter.2022.100452</a>)</p>
<p>Ning Y, Li S, Ong ME, Xie F, Chakraborty B, Ting DS, Liu N. A novel interpretable machine learning system to generate clinical risk scores: An application for predicting early mortality or unplanned readmission in a retrospective cohort study. <em>PLOS Digit Health</em> 1(6): e0000062. (<a href="https://doi.org/10.1371/journal.pdig.0000062" class="uri">https://doi.org/10.1371/journal.pdig.0000062</a>)</p>
<section id="step-1-prepare-training-validation-and-test-datasets" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="step-1-prepare-training-validation-and-test-datasets"><span class="header-section-number">8.1</span> Step 1: Prepare training, validation, and test datasets</h2>
<ul>
<li>Same split-sample set-up as in <a href="./04-autoscore.html#top">Chapter 5, Demo 1</a>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AutoScore)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"sample_data"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sample_data)[<span class="fu">names</span>(sample_data) <span class="sc">==</span> <span class="st">"Mortality_inpatient"</span>] <span class="ot">&lt;-</span> <span class="st">"label"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">check_data</span>(sample_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Your dataset doesn't have any missing values.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Data type check passed.</code></pre>
</div>
</div>
<ul>
<li>ShapleyVIC requires binary outcomes to be coded as 0 and 1 or -1 and 1.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>sample_data<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(sample_data<span class="sc">$</span>label <span class="sc">==</span> <span class="st">"TRUE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>out_split <span class="ot">&lt;-</span> <span class="fu">split_data</span>(<span class="at">data =</span> sample_data, <span class="at">ratio =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>train_set <span class="ot">&lt;-</span> out_split<span class="sc">$</span>train_set</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>validation_set <span class="ot">&lt;-</span> out_split<span class="sc">$</span>validation_set</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>test_set <span class="ot">&lt;-</span> out_split<span class="sc">$</span>test_set</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-2-variable-ranking-from-shapleyvic-analysis-of-nearly-optimal-models" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="step-2-variable-ranking-from-shapleyvic-analysis-of-nearly-optimal-models"><span class="header-section-number">8.2</span> Step 2: Variable ranking from ShapleyVIC analysis of nearly optimal models</h2>
<section id="install-shapleyvic-package-from-github" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="install-shapleyvic-package-from-github"><span class="header-section-number">8.2.1</span> Install ShapleyVIC package from GitHub</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"devtools"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install_github</span>(<span class="at">repo =</span> <span class="st">"nliulab/ShapleyVIC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-r-packages" class="level3" data-number="8.2.2">
<h3 data-number="8.2.2" class="anchored" data-anchor-id="load-r-packages"><span class="header-section-number">8.2.2</span> Load R packages</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car) <span class="co"># For VIF analysis of optimal model (needed for ShapleyVIC analysis)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ShapleyVIC)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># For convenient data manipulation and visualization</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr) <span class="co"># For convenient data manipulation</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="train-the-optimal-logistic-regression-model-and-check-for-colinearity" class="level3" data-number="8.2.3">
<h3 data-number="8.2.3" class="anchored" data-anchor-id="train-the-optimal-logistic-regression-model-and-check-for-colinearity"><span class="header-section-number">8.2.3</span> Train the optimal logistic regression model and check for colinearity</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>m_optim_r <span class="ot">&lt;-</span> <span class="fu">glm</span>(label <span class="sc">~</span> ., <span class="at">data =</span> train_set, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>var_vif <span class="ot">&lt;-</span> <span class="fu">vif</span>(m_optim_r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="generate-a-random-set-of-350-nearly-optimal-models" class="level3" data-number="8.2.4">
<h3 data-number="8.2.4" class="anchored" data-anchor-id="generate-a-random-set-of-350-nearly-optimal-models"><span class="header-section-number">8.2.4</span> Generate a random set of 350 nearly optimal models</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">draw_models</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_optim =</span> <span class="fu">coef</span>(m_optim_r), <span class="at">coef_optim_var =</span> <span class="fu">vcov</span>(m_optim_r),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> train_set[, <span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>], <span class="at">y =</span> train_set<span class="sc">$</span>label,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">M =</span> <span class="dv">800</span>, <span class="at">u1 =</span> <span class="fl">0.5</span>, <span class="at">u2 =</span> <span class="dv">18</span>, <span class="at">epsilon =</span> <span class="fl">0.05</span>, <span class="at">n_final =</span> <span class="dv">350</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07-autoscore_shapleyvic_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>Parameters <code>u1</code> and <code>u2</code> need tuning:</p>
<ul>
<li><code>u1</code> usually takes a small value around 0.5.</li>
<li><code>u2</code> can take a large value for large data.</li>
</ul>
<p>As detailed in the Methods section of <a href="https://doi.org/10.1016/j.patter.2022.100452">the ShapleyVIC paper</a>, these two values can be selected via grid search, using a smaller size of initial sample (e.g., <code>M = 100</code>) to reduce run time. Select values of <code>u1</code> and <code>u2</code> such that:</p>
<ol type="1">
<li>Around 75% of initial samples were eligible.</li>
<li>The range of 1-1.05 times of minimum loss is well represented in the eligible models (see histogram above, generated by <code>draw_models()</code>).</li>
</ol>
</section>
<section id="compute-shapleyvic-values-from-nearly-optimal-models" class="level3" data-number="8.2.5">
<h3 data-number="8.2.5" class="anchored" data-anchor-id="compute-shapleyvic-values-from-nearly-optimal-models"><span class="header-section-number">8.2.5</span> Compute ShapleyVIC values from nearly optimal models</h3>
<p>Use the first 3500 observations in the validation set to compute ShapleyVIC values. This step will be time consuming, and users are recommended to use parallel computing if the computer used has multiple cores (using the <code>n_cores</code> parameter).</p>
<p>To check the number of cores available, use the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>n_cores_total <span class="ot">=</span> <span class="fu">detectCores</span>(<span class="at">logical =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The appropriate number of cores to use depends on the total memory available and the total number of variables. Users may start with <code>n_cores = floor(n_cores_total / 2)</code>, inspect the total % of CPU used, and adjust <code>n_cores</code> to avoid 100% CPU usage (which may freeze the computation process). This example used 6 out of 8 cores on a Mac mini (M1, 2020) and took 50 hours. Users are recommended to save outputs from individual models to a folder for backup purpose, by using the <code>output_folder</code> parameter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a python version of optimal model:</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>m_optim <span class="ot">&lt;-</span> <span class="fu">logit_model_python</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_train =</span> train_set[, <span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>], <span class="at">y_train =</span> train_set<span class="sc">$</span>label</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the python version of optimal model to compute ShapleyVIC values:</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>df_shapley_vic <span class="ot">&lt;-</span> <span class="fu">compute_shapley_vic</span>(</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_py =</span> m_optim, <span class="at">var_vif =</span> var_vif, <span class="at">var_vif_threshold =</span> <span class="dv">2</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_mat =</span> df_models[, <span class="fu">setdiff</span>(<span class="fu">names</span>(df_models), <span class="st">"perf_metric"</span>)], </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">perf_metric =</span> df_models<span class="sc">$</span>perf_metric, </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_test =</span> Out_split<span class="sc">$</span>validation_set[<span class="dv">1</span><span class="sc">:</span><span class="dv">3500</span>, x_names_display], </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_test =</span> Out_split<span class="sc">$</span>validation_set<span class="sc">$</span>label[<span class="dv">1</span><span class="sc">:</span><span class="dv">3500</span>], </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_folder =</span> <span class="st">"shapley_vic_output"</span>, <span class="co"># Results for each model is saved to this folder</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_cores =</span> <span class="dv">6</span> </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="variable-important-analysis-using-shapleyvic-values" class="level3" data-number="8.2.6">
<h3 data-number="8.2.6" class="anchored" data-anchor-id="variable-important-analysis-using-shapleyvic-values"><span class="header-section-number">8.2.6</span> Variable important analysis using ShapleyVIC values</h3>
<p>Before proceeding to develop scoring models, users can summarize and visualize the ShapleyVIC values to assess the contribution of the 20 candidate variables to the outcome.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df_shapley_vic_bar <span class="ot">&lt;-</span> df_shapley_vic <span class="sc">%$%</span> <span class="fu">summarise_shapley_vic</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">val =</span> shapley_vic_val, <span class="at">val_sd =</span> sage_sd, <span class="at">var_names =</span> var_names</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>df_shapley_vic_bar <span class="sc">%$%</span> <span class="fu">draw_bars</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">val =</span> val, <span class="at">val_lower =</span> val_lower, <span class="at">val_upper =</span> val_upper, <span class="at">var_names =</span> Variable, </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Overall variable importance across 350 nearly optimal models"</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07-autoscore_shapleyvic_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df_shapley_vic <span class="sc">%$%</span> <span class="fu">draw_violins</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_names =</span> var_names, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_ordering =</span> <span class="fu">levels</span>(df_shapley_vic_bar<span class="sc">$</span>Variable),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">val =</span> shapley_vic_val, <span class="at">perf_metric =</span> perf_metric, </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Variable importance from 350 nearly optimal models"</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07-autoscore_shapleyvic_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="576"></p>
</div>
</div>
</section>
<section id="generate-ensemble-variable-ranking-from-shapleyvic" class="level3" data-number="8.2.7">
<h3 data-number="8.2.7" class="anchored" data-anchor-id="generate-ensemble-variable-ranking-from-shapleyvic"><span class="header-section-number">8.2.7</span> Generate ensemble variable ranking from ShapleyVIC</h3>
<ul>
<li>Use <code>summarise = TRUE</code> to generate ensemble variable ranking by averaging variable ranks across the 350 nearly optimal models.</li>
<li>Exclude variables with non-significant overall importance to simplify subsequent model development, based on the 95% prediction interval of average ShapleyVIC values.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>val_ranks <span class="ot">&lt;-</span> df_shapley_vic <span class="sc">%$%</span> <span class="fu">rank_variables</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">val =</span> shapley_vic_val, <span class="at">val_sd =</span> sage_sd, <span class="at">model_id =</span> model_id, <span class="at">var_names =</span> var_names, </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">summarise =</span> <span class="cn">TRUE</span>, <span class="at">ties.method =</span> <span class="st">"min"</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(mean_rank) <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Variable <span class="sc">%in%</span> df_shapley_vic_bar<span class="sc">$</span>Variable[<span class="fu">which</span>(df_shapley_vic_bar<span class="sc">$</span>val_lower <span class="sc">&gt;</span> <span class="dv">0</span>)])</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(val_ranks, <span class="at">digits =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">mean_rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Age</td>
<td style="text-align: right;">1.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lab_H</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vital_E</td>
<td style="text-align: right;">3.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lab_K</td>
<td style="text-align: right;">4.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vital_A</td>
<td style="text-align: right;">5.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lab_B</td>
<td style="text-align: right;">5.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vital_C</td>
<td style="text-align: right;">8.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lab_C</td>
<td style="text-align: right;">9.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lab_M</td>
<td style="text-align: right;">9.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lab_E</td>
<td style="text-align: right;">10.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lab_D</td>
<td style="text-align: right;">10.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lab_L</td>
<td style="text-align: right;">11.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vital_D</td>
<td style="text-align: right;">13.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lab_J</td>
<td style="text-align: right;">14.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vital_B</td>
<td style="text-align: right;">14.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Vital_F</td>
<td style="text-align: right;">16.5</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Smaller value of <code>mean_rank</code> indicates higher importance.</p>
</section>
</section>
<section id="step-3-model-development-using-shapleyvic-based-ranking-and-autoscore-workflow" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="step-3-model-development-using-shapleyvic-based-ranking-and-autoscore-workflow"><span class="header-section-number">8.3</span> Step 3: Model development using ShapleyVIC-based ranking and AutoScore workflow</h2>
<section id="prepare-variable-ranking-list-for-autoscore" class="level3" data-number="8.3.1">
<h3 data-number="8.3.1" class="anchored" data-anchor-id="prepare-variable-ranking-list-for-autoscore"><span class="header-section-number">8.3.1</span> Prepare variable ranking list for AutoScore</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ranking <span class="ot">&lt;-</span> val_ranks<span class="sc">$</span>mean_rank</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ranking) <span class="ot">&lt;-</span> val_ranks<span class="sc">$</span>Variable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="select-the-best-model-with-parsimony-plot-autoscore-modules-234" class="level3" data-number="8.3.2">
<h3 data-number="8.3.2" class="anchored" data-anchor-id="select-the-best-model-with-parsimony-plot-autoscore-modules-234"><span class="header-section-number">8.3.2</span> Select the best model with parsimony plot (AutoScore Modules 2+3+4)</h3>
<ul>
<li>Parsimony plot from ShapleyVIC-based variable ranking is smoother than that <a href="./04-autoscore.html#rf-pars">based on random forest</a>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>AUC <span class="ot">&lt;-</span> <span class="fu">AutoScore_parsimony</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">train_set =</span> train_set, <span class="at">validation_set =</span> validation_set, </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">rank =</span> ranking, <span class="at">max_score =</span> <span class="dv">100</span>, <span class="at">n_min =</span> <span class="dv">1</span>, <span class="at">n_max =</span> <span class="fu">length</span>(ranking)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Select 1 Variable(s):  Area under the curve: 0.6649
Select 2 Variable(s):  Area under the curve: 0.7466
Select 3 Variable(s):  Area under the curve: 0.7881
Select 4 Variable(s):  Area under the curve: 0.8009
Select 5 Variable(s):  Area under the curve: 0.8137
Select 6 Variable(s):  Area under the curve: 0.8268
Select 7 Variable(s):  Area under the curve: 0.8221
Select 8 Variable(s):  Area under the curve: 0.8227
Select 9 Variable(s):  Area under the curve: 0.8215
Select 10 Variable(s):  Area under the curve: 0.8185
Select 11 Variable(s):  Area under the curve: 0.8274
Select 12 Variable(s):  Area under the curve: 0.8294
Select 13 Variable(s):  Area under the curve: 0.8281
Select 14 Variable(s):  Area under the curve: 0.8261
Select 15 Variable(s):  Area under the curve: 0.8256
Select 16 Variable(s):  Area under the curve: 0.8322</code></pre>
</div>
<div class="cell-output-display">
<p><img src="07-autoscore_shapleyvic_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>A feasible choice is to select the top 6 variables, Age, Lab_H, Vital_E, Lab_K, Vital_A, Lab_B, resulting in the same model as developed in <a href="./04-autoscore.html#model">Chapter 5</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>cut_vec <span class="ot">&lt;-</span> <span class="fu">AutoScore_weighting</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">train_set =</span> train_set, <span class="at">validation_set =</span> validation_set, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">final_variables =</span> <span class="fu">names</span>(ranking)[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>], <span class="at">max_score =</span> <span class="dv">100</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>****Included Variables: 
  variable_name
1           Age
2         Lab_H
3       Vital_E
4         Lab_K
5       Vital_A
6         Lab_B
****Initial Scores: 


========  ==========  =====
variable  interval    point
========  ==========  =====
Age       &lt;35           0  
          [35,49)       7  
          [49,76)      17  
          [76,89)      23  
          &gt;=89         27  
                           
Lab_H     &lt;0.2          0  
          [0.2,1.1)     4  
          [1.1,3.1)     9  
          [3.1,4)      15  
          &gt;=4          18  
                           
Vital_E   &lt;12           0  
          [12,15)       2  
          [15,22)       7  
          [22,25)      12  
          &gt;=25         15  
                           
Lab_K     &lt;8            0  
          [8,42)        6  
          [42,58)      11  
          &gt;=58         14  
                           
Vital_A   &lt;60           0  
          [60,73)       1  
          [73,98)       6  
          [98,111)     10  
          &gt;=111        13  
                           
Lab_B     &lt;8.5          0  
          [8.5,11.2)    4  
          [11.2,17)     7  
          [17,19.8)    10  
          &gt;=19.8       12  
========  ==========  =====</code></pre>
</div>
<div class="cell-output-display">
<p><img src="07-autoscore_shapleyvic_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="480"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>***Performance (based on validation set):
AUC:  0.8268   95% CI: 0.7953-0.8583 (DeLong)
Best score threshold: &gt;= 57 
Other performance indicators based on this score threshold: 
Sensitivity: 0.8065
Specificity: 0.6775
PPV:         0.1736
NPV:         0.9766
***The cutoffs of each variable generated by the AutoScore are saved in cut_vec. You can decide whether to revise or fine-tune them </code></pre>
</div>
</div>
<p>Users can follow detailed steps in <a href="./04-autoscore.html">Chapter 5</a> for subsequent model fine-tuning and evaluation.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="./06-autoscore_ordinal.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">AutoScore for ordinal outcomes (AutoScore-Ordinal)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>