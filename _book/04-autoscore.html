<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.594">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>AutoScore: An Interpretable Machine Learning-Based Automatic Clinical Score Generator - 5&nbsp; AutoScore for binary outcomes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./05-autoscore_survival.html" rel="next">
<link href="./03-data_processing.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.5.1/plotly-latest.min.js"></script>


<link rel="stylesheet" href="custom.css">
</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">AutoScore for binary outcomes</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">AutoScore: An Interpretable Machine Learning-Based Automatic Clinical Score Generator</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">AutoScore Introduction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-related_papers.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Related Published papers</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./011Installation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Package Installation and import</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-desc_analysis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Descriptive analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-data_processing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data processing and checking</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-autoscore.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">AutoScore for binary outcomes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-autoscore_survival.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">AutoScore for survival outcomes (AutoScore-Survival)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-autoscore_ordinal.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">AutoScore for ordinal outcomes (AutoScore-Ordinal)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-autoscore_shapleyvic.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">AutoScore-ShapleyVIC for binary outcomes</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#development-with-large-sample" id="toc-development-with-large-sample" class="nav-link active" data-scroll-target="#development-with-large-sample"> <span class="header-section-number">5.1</span> development with large sample</a>
  <ul class="collapse">
  <li><a href="#load-package-and-data" id="toc-load-package-and-data" class="nav-link" data-scroll-target="#load-package-and-data"> <span class="header-section-number">5.1.1</span> load package and data</a></li>
  <li><a href="#prepare-training-validation-and-test-datasets" id="toc-prepare-training-validation-and-test-datasets" class="nav-link" data-scroll-target="#prepare-training-validation-and-test-datasets"> <span class="header-section-number">5.1.2</span> Prepare training, validation, and test datasets</a></li>
  <li><a href="#stepi-generate-variable-ranking-list-autoscore-module-1" id="toc-stepi-generate-variable-ranking-list-autoscore-module-1" class="nav-link" data-scroll-target="#stepi-generate-variable-ranking-list-autoscore-module-1"> <span class="header-section-number">5.1.3</span> STEP(i): Generate variable ranking list (AutoScore Module 1)</a></li>
  <li><a href="#rf-pars" id="toc-rf-pars" class="nav-link" data-scroll-target="#rf-pars"> <span class="header-section-number">5.1.4</span> STEP(ii): Select the best model with parsimony plot (AutoScore Modules 2+3+4)</a></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model"> <span class="header-section-number">5.1.5</span> STEP(iii): Generate initial scores with the final list of variables (Re-run AutoScore Modules 2+3)</a></li>
  <li><a href="#stepiv-fine-tune-the-initial-score-generated-in-stepiii-autoscore-module-5-re-run-autoscore-modules-23" id="toc-stepiv-fine-tune-the-initial-score-generated-in-stepiii-autoscore-module-5-re-run-autoscore-modules-23" class="nav-link" data-scroll-target="#stepiv-fine-tune-the-initial-score-generated-in-stepiii-autoscore-module-5-re-run-autoscore-modules-23"> <span class="header-section-number">5.1.6</span> STEP(iv): Fine-tune the initial score generated in STEP(iii) (AutoScore Module 5 &amp; Re-run AutoScore Modules 2+3)</a></li>
  <li><a href="#stepv-evaluate-final-risk-scores-on-test-dataset-autoscore-module-6" id="toc-stepv-evaluate-final-risk-scores-on-test-dataset-autoscore-module-6" class="nav-link" data-scroll-target="#stepv-evaluate-final-risk-scores-on-test-dataset-autoscore-module-6"> <span class="header-section-number">5.1.7</span> STEP(v): Evaluate final risk scores on test dataset (AutoScore Module 6)</a></li>
  </ul></li>
  <li><a href="#evaluation-conversion-table-calibration-etc" id="toc-evaluation-conversion-table-calibration-etc" class="nav-link" data-scroll-target="#evaluation-conversion-table-calibration-etc"> <span class="header-section-number">5.2</span> evaluation (conversion table, calibration etc)</a></li>
  <li><a href="#development-on-small-dataset-sample-size-1000-with-cross-validation" id="toc-development-on-small-dataset-sample-size-1000-with-cross-validation" class="nav-link" data-scroll-target="#development-on-small-dataset-sample-size-1000-with-cross-validation"> <span class="header-section-number">5.3</span> development on Small dataset (sample size = 1000) with cross-validation**</a>
  <ul class="collapse">
  <li><a href="#get-small-dataset-with-1000-samples" id="toc-get-small-dataset-with-1000-samples" class="nav-link" data-scroll-target="#get-small-dataset-with-1000-samples"> <span class="header-section-number">5.3.1</span> Get small dataset with 1000 samples</a></li>
  <li><a href="#prepare-training-and-test-datasets" id="toc-prepare-training-and-test-datasets" class="nav-link" data-scroll-target="#prepare-training-and-test-datasets"> <span class="header-section-number">5.3.2</span> Prepare training and test datasets</a></li>
  <li><a href="#stepi-generate-variable-ranking-list-autoscore-module-1-1" id="toc-stepi-generate-variable-ranking-list-autoscore-module-1-1" class="nav-link" data-scroll-target="#stepi-generate-variable-ranking-list-autoscore-module-1-1"> <span class="header-section-number">5.3.3</span> STEP(i): Generate variable ranking list (AutoScore Module 1)</a></li>
  <li><a href="#stepii-select-the-best-model-with-parsimony-plot-autoscore-modules-234" id="toc-stepii-select-the-best-model-with-parsimony-plot-autoscore-modules-234" class="nav-link" data-scroll-target="#stepii-select-the-best-model-with-parsimony-plot-autoscore-modules-234"> <span class="header-section-number">5.3.4</span> STEP(ii): Select the best model with parsimony plot (AutoScore Modules 2+3+4)</a></li>
  <li><a href="#stepiii-generate-initial-scores-with-the-final-list-of-variables-re-run-autoscore-modules-23" id="toc-stepiii-generate-initial-scores-with-the-final-list-of-variables-re-run-autoscore-modules-23" class="nav-link" data-scroll-target="#stepiii-generate-initial-scores-with-the-final-list-of-variables-re-run-autoscore-modules-23"> <span class="header-section-number">5.3.5</span> STEP(iii): Generate initial scores with the final list of variables (Re-run AutoScore Modules 2+3)</a></li>
  <li><a href="#stepiv-fine-tune-the-initial-score-generated-in-stepiii-autoscore-module-5-re-run-autoscore-modules-23-1" id="toc-stepiv-fine-tune-the-initial-score-generated-in-stepiii-autoscore-module-5-re-run-autoscore-modules-23-1" class="nav-link" data-scroll-target="#stepiv-fine-tune-the-initial-score-generated-in-stepiii-autoscore-module-5-re-run-autoscore-modules-23-1"> <span class="header-section-number">5.3.6</span> STEP(iv): Fine-tune the initial score generated in STEP(iii) (AutoScore Module 5 &amp; Re-run AutoScore Modules 2+3)</a></li>
  <li><a href="#stepv-evaluate-final-risk-scores-on-test-dataset-autoscore-module-6-1" id="toc-stepv-evaluate-final-risk-scores-on-test-dataset-autoscore-module-6-1" class="nav-link" data-scroll-target="#stepv-evaluate-final-risk-scores-on-test-dataset-autoscore-module-6-1"> <span class="header-section-number">5.3.7</span> STEP(v): Evaluate final risk scores on test dataset (AutoScore Module 6)</a></li>
  <li><a href="#stepvi-further-analysis-based-on-the-final-scoring-systems-e.g.-conversion-table-model-calibration-output-the-score" id="toc-stepvi-further-analysis-based-on-the-final-scoring-systems-e.g.-conversion-table-model-calibration-output-the-score" class="nav-link" data-scroll-target="#stepvi-further-analysis-based-on-the-final-scoring-systems-e.g.-conversion-table-model-calibration-output-the-score"> <span class="header-section-number">5.3.8</span> STEP(vi): Further analysis based on the final scoring systems (e.g., conversion table, model calibration, output the score)</a></li>
  </ul></li>
  <li><a href="#development-on-dataset-with-missing-values-informative-missing" id="toc-development-on-dataset-with-missing-values-informative-missing" class="nav-link" data-scroll-target="#development-on-dataset-with-missing-values-informative-missing"> <span class="header-section-number">5.4</span> development on dataset with missing values (informative missing)**</a>
  <ul class="collapse">
  <li><a href="#load-package-and-data-1" id="toc-load-package-and-data-1" class="nav-link" data-scroll-target="#load-package-and-data-1"> <span class="header-section-number">5.4.1</span> load package and data</a></li>
  <li><a href="#create-informative-missing" id="toc-create-informative-missing" class="nav-link" data-scroll-target="#create-informative-missing"> <span class="header-section-number">5.4.2</span> Create informative missing</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="top" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">AutoScore for binary outcomes</span></span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="development-with-large-sample" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="development-with-large-sample"><span class="header-section-number">5.1</span> development with large sample</h2>
<p>(sample size = 20000)**</p>
<section id="load-package-and-data" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="load-package-and-data"><span class="header-section-number">5.1.1</span> load package and data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AutoScore)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"sample_data"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sample_data)[<span class="fu">names</span>(sample_data) <span class="sc">==</span> <span class="st">"Mortality_inpatient"</span>] <span class="ot">&lt;-</span> <span class="st">"label"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">check_data</span>(sample_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Your dataset doesn't have any missing values.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Data type check passed.</code></pre>
</div>
</div>
<p>In Demo #1, we demonstrate the use of AutoScore on a comparably large dataset where separate training and validation sets are available. Please note that it is just a demo using simulated data, and thus, the result might not be clinically meaningful.</p>
</section>
<section id="prepare-training-validation-and-test-datasets" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="prepare-training-validation-and-test-datasets"><span class="header-section-number">5.1.2</span> Prepare training, validation, and test datasets</h3>
<ul>
<li>Option 1: Prepare three separate datasets to train, validate, and test models.</li>
<li>Option 2: Use demo codes below to randomly split your dataset into training, validation, and test datasets (70%, 10%, 20%, respectively).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>out_split <span class="ot">&lt;-</span> <span class="fu">split_data</span>(<span class="at">data =</span> sample_data, <span class="at">ratio =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>train_set <span class="ot">&lt;-</span> out_split<span class="sc">$</span>train_set</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>validation_set <span class="ot">&lt;-</span> out_split<span class="sc">$</span>validation_set</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>test_set <span class="ot">&lt;-</span> out_split<span class="sc">$</span>test_set</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="stepi-generate-variable-ranking-list-autoscore-module-1" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="stepi-generate-variable-ranking-list-autoscore-module-1"><span class="header-section-number">5.1.3</span> STEP(i): Generate variable ranking list (AutoScore Module 1)</h3>
<ul>
<li><p><code>method</code>: “rf” (default) or “auc”.</p></li>
<li><p>method = <code>rf</code>: “rf” refers to random forest-based ranking<br>
</p></li>
<li><p><code>ntree</code>: Number of trees required only if when <code>method</code> is “rf” (Default: 100).</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ranking <span class="ot">&lt;-</span> <span class="fu">AutoScore_rank</span>(<span class="at">train_set =</span> train_set, <span class="at">method =</span> <span class="st">"rf"</span>, <span class="at">ntree =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The ranking based on variable importance was shown below for each variable: 
      Age     Lab_H     Lab_K     Lab_B   Vital_E   Vital_A     Lab_I     Lab_A 
152.24380 151.60648 147.96133 134.85962 130.84508 128.05477 106.01727  96.68171 
  Vital_C   Vital_B     Lab_M     Lab_J   Vital_D     Lab_D   Vital_F     Lab_E 
 94.91108  94.41436  92.31222  84.42058  83.63048  80.23488  77.07122  75.73559 
    Lab_C     Lab_F     Lab_L     Lab_G   Vital_G 
 75.48998  75.08788  72.61001  56.33592  56.08578 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="04-autoscore_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">

</div>
<ul>
<li>method = <code>auc</code>: “auc” refers to the AUC-based ranking. For “auc”, univariate models will be built based on the train set, and the variable ranking is constructed via the AUC performance of corresponding univariate models on the validation set (<code>validation_set</code>).<br>
</li>
<li><code>validation_set</code>: validation set required only if when <code>method</code> is “auc”.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ranking <span class="ot">&lt;-</span> <span class="fu">AutoScore_rank</span>(<span class="at">train_set =</span> train_set, <span class="at">method =</span> <span class="st">"auc"</span>, <span class="at">validation_set =</span> validation_set)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The auc-based ranking based on variable importance was shown below for each variable: 
    Lab_H       Age     Lab_B     Lab_K   Vital_E   Vital_A     Lab_M     Lab_C 
0.7016120 0.6926165 0.6796975 0.6741446 0.6708401 0.6319503 0.6010980 0.6010525 
    Lab_G   Vital_C   Vital_D     Lab_F     Lab_L     Lab_A   Vital_F   Vital_G 
0.5777848 0.5743282 0.5617414 0.5606434 0.5427415 0.5392167 0.5380191 0.5345188 
  Vital_B     Lab_D     Lab_I     Lab_E     Lab_J 
0.5326130 0.5186835 0.5139225 0.4888609 0.4845179 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="04-autoscore_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">

</div>
</section>
<section id="rf-pars" class="level3" data-number="5.1.4">
<h3 data-number="5.1.4" class="anchored" data-anchor-id="rf-pars"><span class="header-section-number">5.1.4</span> STEP(ii): Select the best model with parsimony plot (AutoScore Modules 2+3+4)</h3>
<ul>
<li><code>nmin</code>: Minimum number of selected variables (Default: 1).</li>
<li><code>nmax</code>: Maximum number of selected variables (Default: 20).</li>
<li><code>categorize</code>: Methods for categorizing continuous variables. Options include <code>"quantile"</code> or <code>"kmeans"</code> (Default: <code>"quantile"</code>).</li>
<li><code>quantiles</code>: Predefined quantiles to convert continuous variables to categorical ones. (Default: <code>c(0, 0.05, 0.2, 0.8, 0.95, 1)</code>) Available if <code>categorize = "quantile"</code>.</li>
<li><code>max_cluster</code>: The max number of cluster (Default: 5). Available if <code>categorize = "kmeans"</code>.</li>
<li><code>max_score</code>: Maximum total score (Default: 100).</li>
<li><code>auc_lim_min</code>: Min y_axis limit in the parsimony plot (Default: 0.5).</li>
<li><code>auc_lim_max</code>: Max y_axis limit in the parsimony plot (Default: “adaptive”).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>AUC <span class="ot">&lt;-</span> <span class="fu">AutoScore_parsimony</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">train_set =</span> train_set,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">validation_set =</span> validation_set,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank =</span> ranking,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_score =</span> <span class="dv">100</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_min =</span> <span class="dv">1</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_max =</span> <span class="dv">20</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">categorize =</span> <span class="st">"quantile"</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="fl">0.95</span>, <span class="dv">1</span>),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">auc_lim_min =</span> <span class="fl">0.5</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">auc_lim_max =</span> <span class="st">"adaptive"</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Select 1 Variable(s):  Area under the curve: 0.6649
Select 2 Variable(s):  Area under the curve: 0.7466
Select 3 Variable(s):  Area under the curve: 0.7729
Select 4 Variable(s):  Area under the curve: 0.7915
Select 5 Variable(s):  Area under the curve: 0.8138
Select 6 Variable(s):  Area under the curve: 0.8268
Select 7 Variable(s):  Area under the curve: 0.822
Select 8 Variable(s):  Area under the curve: 0.8196
Select 9 Variable(s):  Area under the curve: 0.8188
Select 10 Variable(s):  Area under the curve: 0.8184
Select 11 Variable(s):  Area under the curve: 0.8178
Select 12 Variable(s):  Area under the curve: 0.8238
Select 13 Variable(s):  Area under the curve: 0.8224
Select 14 Variable(s):  Area under the curve: 0.8256
Select 15 Variable(s):  Area under the curve: 0.8301
Select 16 Variable(s):  Area under the curve: 0.8278
Select 17 Variable(s):  Area under the curve: 0.8269
Select 18 Variable(s):  Area under the curve: 0.8273
Select 19 Variable(s):  Area under the curve: 0.8244
Select 20 Variable(s):  Area under the curve: 0.8259</code></pre>
</div>
<div class="cell-output-display">
<p><img src="04-autoscore_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Users could use the <code>AUC</code> for further analysis or export it as the CSV to other software for plotting.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">data.frame</span>(AUC), <span class="at">file =</span> <span class="st">"D:/AUC.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Determine the optimal number of variables (<code>num_var</code>) based on the parsimony plot obtained in STEP(ii).</li>
<li>The final list of variables is the first <code>num_var</code> variables in the ranked list <code>ranking</code> obtained in STEP(i).</li>
<li>Optional: User can adjust the finally included variables <code>final_variables</code> based on the clinical preferences and knowledge.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 1: Top 6 variables are selected</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>num_var <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>final_variables <span class="ot">&lt;-</span> <span class="fu">names</span>(ranking[<span class="dv">1</span><span class="sc">:</span>num_var])</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 2: Top 9 variables are selected</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>num_var <span class="ot">&lt;-</span> <span class="dv">9</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>final_variables <span class="ot">&lt;-</span> <span class="fu">names</span>(ranking[<span class="dv">1</span><span class="sc">:</span>num_var])</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 3: Top 6 variables, the 9th and 10th variable are selected</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>num_var <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>final_variables <span class="ot">&lt;-</span> <span class="fu">names</span>(ranking[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>num_var, <span class="dv">9</span>, <span class="dv">10</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model" class="level3" data-number="5.1.5">
<h3 data-number="5.1.5" class="anchored" data-anchor-id="model"><span class="header-section-number">5.1.5</span> STEP(iii): Generate initial scores with the final list of variables (Re-run AutoScore Modules 2+3)</h3>
<ul>
<li>Generate <code>cut_vec</code> with current cutoffs of continuous variables, which can be fine-tuned in STEP(iv).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>cut_vec <span class="ot">&lt;-</span> <span class="fu">AutoScore_weighting</span>( </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">train_set =</span> train_set,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">validation_set =</span> validation_set,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">final_variables =</span> final_variables,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_score =</span> <span class="dv">100</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">categorize =</span> <span class="st">"quantile"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="fl">0.95</span>, <span class="dv">1</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>****Included Variables: 
  variable_name
1           Age
2         Lab_H
3         Lab_K
4         Lab_B
5       Vital_E
6       Vital_A
****Initial Scores: 


========  ==========  =====
variable  interval    point
========  ==========  =====
Age       &lt;35           0  
          [35,49)       7  
          [49,76)      17  
          [76,89)      23  
          &gt;=89         27  
                           
Lab_H     &lt;0.2          0  
          [0.2,1.1)     4  
          [1.1,3.1)     9  
          [3.1,4)      15  
          &gt;=4          18  
                           
Lab_K     &lt;8            0  
          [8,42)        6  
          [42,58)      11  
          &gt;=58         14  
                           
Lab_B     &lt;8.5          0  
          [8.5,11.2)    4  
          [11.2,17)     7  
          [17,19.8)    10  
          &gt;=19.8       12  
                           
Vital_E   &lt;12           0  
          [12,15)       2  
          [15,22)       7  
          [22,25)      12  
          &gt;=25         15  
                           
Vital_A   &lt;60           0  
          [60,73)       1  
          [73,98)       6  
          [98,111)     10  
          &gt;=111        13  
========  ==========  =====</code></pre>
</div>
<div class="cell-output-display">
<p><img src="04-autoscore_files/figure-html/weighting-1.png" class="img-fluid" width="480"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>***Performance (based on validation set):
AUC:  0.8268   95% CI: 0.7953-0.8583 (DeLong)
Best score threshold: &gt;= 57 
Other performance indicators based on this score threshold: 
Sensitivity: 0.8065
Specificity: 0.6775
PPV:         0.1736
NPV:         0.9766
***The cutoffs of each variable generated by the AutoScore are saved in cut_vec. You can decide whether to revise or fine-tune them </code></pre>
</div>
</div>
</section>
<section id="stepiv-fine-tune-the-initial-score-generated-in-stepiii-autoscore-module-5-re-run-autoscore-modules-23" class="level3" data-number="5.1.6">
<h3 data-number="5.1.6" class="anchored" data-anchor-id="stepiv-fine-tune-the-initial-score-generated-in-stepiii-autoscore-module-5-re-run-autoscore-modules-23"><span class="header-section-number">5.1.6</span> STEP(iv): Fine-tune the initial score generated in STEP(iii) (AutoScore Module 5 &amp; Re-run AutoScore Modules 2+3)</h3>
<ul>
<li>Revise <code>cut_vec</code> with domain knowledge to update the scoring table (AutoScore Module 5).</li>
<li>Re-run AutoScore Modules 2+3 to generate the updated scores.</li>
<li>Users can choose any cutoff values and/or any number of categories, but are suggested to choose numbers close to the automatically determined values.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## For example, we have current cutoffs of continuous variable: Age </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="do">## ==============  ===========  =====</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="do">## variable        interval     point</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="do">## ==============  ===========  =====</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Age             &lt;35            0  </span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="do">##                 [35,49)        7  </span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="do">##                 [49,76)       17  </span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="do">##                 [76,89)       23  </span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="do">##                 &gt;=89          27  </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Current cutoffs:<code>c(35, 49, 76, 89)</code>. We can fine tune the cutoffs as follows:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 1: rounding up to a nice number</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>cut_vec<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">35</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">90</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 2: changing cutoffs according to clinical knowledge or preference </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>cut_vec<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">90</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 3: combining categories</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>cut_vec<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Then we do similar checks for other variables and update scoring table using new cutoffs if needed.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>cut_vec<span class="sc">$</span>Lab_H <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>cut_vec<span class="sc">$</span>Lab_K <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">40</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>cut_vec<span class="sc">$</span>Lab_B <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">17</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>cut_vec<span class="sc">$</span>hVital_A<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">70</span>, <span class="dv">98</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>scoring_table <span class="ot">&lt;-</span> <span class="fu">AutoScore_fine_tuning</span>(train_set,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                        validation_set,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                        final_variables,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                        cut_vec,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">max_score =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>***Fine-tuned Scores: 


========  ========  =====
variable  interval  point
========  ========  =====
Age       &lt;50         0  
          [50,75)    11  
          [75,90)    19  
          &gt;=90       24  
                         
Lab_H     &lt;0.2        0  
          [0.2,1)     6  
          [1,3)      11  
          [3,4)      17  
          &gt;=4        21  
                         
Lab_K     &lt;10         0  
          [10,40)     8  
          &gt;=40       14  
                         
Lab_B     &lt;10         0  
          [10,17)     3  
          &gt;=17        8  
                         
Vital_E   &lt;12         0  
          [12,15)     1  
          [15,22)     8  
          [22,25)    15  
          &gt;=25       18  
                         
Vital_A   &lt;60         0  
          [60,73)     1  
          [73,98)     7  
          [98,111)   11  
          &gt;=111      15  
========  ========  =====</code></pre>
</div>
<div class="cell-output-display">
<p><img src="04-autoscore_files/figure-html/scoring-1.png" class="img-fluid" width="480"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>***Performance (based on validation set, after fine-tuning):
AUC:  0.8209   95% CI: 0.7884-0.8533 (DeLong)
Best score threshold: &gt;= 54 
Other performance indicators based on this score threshold: 
Sensitivity: 0.8452
Specificity: 0.658
PPV:         0.1719
NPV:         0.9806</code></pre>
</div>
</div>
</section>
<section id="stepv-evaluate-final-risk-scores-on-test-dataset-autoscore-module-6" class="level3" data-number="5.1.7">
<h3 data-number="5.1.7" class="anchored" data-anchor-id="stepv-evaluate-final-risk-scores-on-test-dataset-autoscore-module-6"><span class="header-section-number">5.1.7</span> STEP(v): Evaluate final risk scores on test dataset (AutoScore Module 6)</h3>
<ul>
<li><code>threshold</code>: Score threshold for the ROC analysis to generate sensitivity, specificity, etc. If set to <code>"best"</code>, the optimal threshold will be calculated (Default: <code>"best"</code>).</li>
<li><code>with_label</code>: Set to <code>TRUE</code> if there are labels in the <code>test_set</code> and performance will be evaluated accordingly (Default: <code>TRUE</code>).</li>
<li>Set the <code>with_label</code> to <code>FALSE</code> if there are not <code>label</code> in the <code>test_set</code> and the final predicted scores will be the output without performance evaluation.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>pred_score <span class="ot">&lt;-</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">AutoScore_testing</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_set =</span> test_set,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">final_variables =</span> final_variables,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cut_vec =</span> cut_vec,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">scoring_table =</span> scoring_table,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="st">"best"</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">with_label =</span> <span class="cn">TRUE</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-autoscore_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="480"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>***Performance using AutoScore:
AUC:  0.836   95% CI: 0.8147-0.8573 (DeLong)
Best score threshold: &gt;= 57 
Other performance indicators based on this score threshold: 
Sensitivity: 0.7557 95% CI: 0.7068-0.8046
Specificity: 0.7669 95% CI: 0.7536-0.7809
PPV:         0.2125 95% CI: 0.1976-0.2269
NPV:         0.9742 95% CI: 0.9691-0.9792</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pred_score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  pred_score Label
1         19 FALSE
2         40 FALSE
3         69  TRUE
4         37 FALSE
5         48 FALSE
6         34 FALSE</code></pre>
</div>
</div>
<ul>
<li>Use <code>print_roc_performance()</code> to generate the performance under different score thresholds (e.g., 50).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print_roc_performance</span>(pred_score<span class="sc">$</span>Label, pred_score<span class="sc">$</span>pred_score, <span class="at">threshold =</span> <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC:  0.836   95% CI: 0.8147-0.8573 (DeLong)
Score threshold: &gt;= 50 
Other performance indicators based on this score threshold: 
Sensitivity: 0.8925
Specificity: 0.5754
PPV:         0.1488
NPV:         0.9847</code></pre>
</div>
</div>
</section>
</section>
<section id="evaluation-conversion-table-calibration-etc" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="evaluation-conversion-table-calibration-etc"><span class="header-section-number">5.2</span> evaluation (conversion table, calibration etc)</h2>
<p>Further analysis based on the final scoring systems (e.g., conversion table, model calibration, output the score) - Use <code>conversion_table()</code> to generate the performance under different risk (i.e., probability of mortality based on logistic regression estimation) cut-off (e.g., 0.01, 0.05, 0.1, 0.2, 0.5).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">conversion_table</span>(<span class="at">pred_score =</span> pred_score, <span class="at">by =</span><span class="st">"risk"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 12%">
<col style="width: 11%">
<col style="width: 16%">
<col style="width: 11%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Predicted Risk [&gt;=]</th>
<th style="text-align: center;">Score cut-off [&gt;=]</th>
<th style="text-align: center;">Percentage of patients (%)</th>
<th style="text-align: center;">Accuracy (95% CI)</th>
<th style="text-align: center;">Sensitivity (95% CI)</th>
<th style="text-align: center;">Specificity (95% CI)</th>
<th style="text-align: center;">PPV (95% CI)</th>
<th style="text-align: center;">NPV (95% CI)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1%</td>
<td style="text-align: center;">38</td>
<td style="text-align: center;">79</td>
<td style="text-align: center;">28.3% (27-29.6%)</td>
<td style="text-align: center;">99% (97.7-100%)</td>
<td style="text-align: center;">22.4% (21-23.8%)</td>
<td style="text-align: center;">9.6% (9.4-9.8%)</td>
<td style="text-align: center;">99.6% (99.2-100%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">5%</td>
<td style="text-align: center;">52</td>
<td style="text-align: center;">42</td>
<td style="text-align: center;">63.4% (61.9-64.8%)</td>
<td style="text-align: center;">87.9% (84.4-91.5%)</td>
<td style="text-align: center;">61.4% (59.8-62.9%)</td>
<td style="text-align: center;">15.9% (15.1-16.7%)</td>
<td style="text-align: center;">98.4% (97.9-98.9%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">10%</td>
<td style="text-align: center;">59</td>
<td style="text-align: center;">24</td>
<td style="text-align: center;">78.9% (77.7-80.2%)</td>
<td style="text-align: center;">71.7% (66.8-76.2%)</td>
<td style="text-align: center;">79.6% (78.3-80.8%)</td>
<td style="text-align: center;">22.6% (21-24.2%)</td>
<td style="text-align: center;">97.1% (96.6-97.6%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">20%</td>
<td style="text-align: center;">66</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">88.6% (87.7-89.4%)</td>
<td style="text-align: center;">46.3% (40.4-52.1%)</td>
<td style="text-align: center;">92.1% (91.3-93%)</td>
<td style="text-align: center;">32.8% (29.1-36.3%)</td>
<td style="text-align: center;">95.4% (94.9-95.9%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">50%</td>
<td style="text-align: center;">79</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">92.7% (92.4-93%)</td>
<td style="text-align: center;">11.1% (7.5-14.7%)</td>
<td style="text-align: center;">99.5% (99.3-99.7%)</td>
<td style="text-align: center;">65.5% (52.6-77.3%)</td>
<td style="text-align: center;">93.1% (92.8-93.3%)</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>Use <code>conversion_table()</code> to generate the performance under different score thresholds (e.g., 20, 40, 60, 75).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">conversion_table</span>(<span class="at">pred_score =</span> pred_score, <span class="at">by =</span> <span class="st">"score"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">40</span>,<span class="dv">60</span>,<span class="dv">75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 11%">
<col style="width: 12%">
<col style="width: 16%">
<col style="width: 11%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Score cut-off [&gt;=]</th>
<th style="text-align: center;">Predicted Risk [&gt;=]</th>
<th style="text-align: center;">Percentage of patients (%)</th>
<th style="text-align: center;">Accuracy (95% CI)</th>
<th style="text-align: center;">Sensitivity (95% CI)</th>
<th style="text-align: center;">Specificity (95% CI)</th>
<th style="text-align: center;">PPV (95% CI)</th>
<th style="text-align: center;">NPV (95% CI)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">20</td>
<td style="text-align: center;">0.1%</td>
<td style="text-align: center;">99</td>
<td style="text-align: center;">8.4% (8.2-8.7%)</td>
<td style="text-align: center;">100% (100-100%)</td>
<td style="text-align: center;">0.8% (0.5-1.1%)</td>
<td style="text-align: center;">7.7% (7.7-7.8%)</td>
<td style="text-align: center;">100% (100-100%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">40</td>
<td style="text-align: center;">1.4%</td>
<td style="text-align: center;">73</td>
<td style="text-align: center;">34.5% (33-36%)</td>
<td style="text-align: center;">98.7% (97.4-99.7%)</td>
<td style="text-align: center;">29.1% (27.6-30.7%)</td>
<td style="text-align: center;">10.4% (10.1-10.6%)</td>
<td style="text-align: center;">99.6% (99.2-99.9%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">60</td>
<td style="text-align: center;">11.4%</td>
<td style="text-align: center;">22</td>
<td style="text-align: center;">80.9% (79.7-82.1%)</td>
<td style="text-align: center;">66.1% (60.9-71.3%)</td>
<td style="text-align: center;">82.1% (80.9-83.3%)</td>
<td style="text-align: center;">23.6% (21.7-25.5%)</td>
<td style="text-align: center;">96.7% (96.2-97.2%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">75</td>
<td style="text-align: center;">40.7%</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">92.5% (92.1-93%)</td>
<td style="text-align: center;">16.6% (12.4-20.8%)</td>
<td style="text-align: center;">98.8% (98.5-99.2%)</td>
<td style="text-align: center;">54.4% (45.1-63.9%)</td>
<td style="text-align: center;">93.4% (93.1-93.8%)</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>the conversion table can also be visualized using an interactive figure.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_predicted_risk</span>(<span class="at">pred_score =</span> pred_score, <span class="at">max_score =</span> <span class="dv">100</span>, </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">final_variables =</span> final_variables, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">scoring_table =</span> scoring_table, <span class="at">point_size =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-ea86a0c9abd6f179fc44" style="width:100%;height:464px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-ea86a0c9abd6f179fc44">{"x":{"data":[{"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.000160761626476474,0.000179712031034194,0.000200895839693951,0.000224576158738925,0.000251047061730852,0.000280637227337393,0.000313714002763483,0.000350687942143996,0.000392017874869922,0.000438216565046196,0.000489857030176067,0.00054757959479765,0.00061209976323019,0.000684217004890703,0.000764824555888407,0.000854920351868366,0.00095561921943002,0.00106816646696101,0.00119395303046642,0.0013345323459925,0.00149163913758179,0.00166721032837019,0.00186340830243218,0.00208264676624271,0.00232761948104048,0.00260133216076123,0.00290713785427768,0.00324877615502836,0.00363041660517322,0.00405670668441435,0.00453282479454595,0.0050645386683183,0.00565826964359599,0.00632116324886896,0.00706116654116293,0.00788711261882795,0.00880881269525833,0.00983715606003304,0.0109842181648333,0.0122633769450486,0.0136894373149923,0.0152787635442536,0.0170494189223042,0.0190213117336812,0.021216346080824,0.023658575488479,0.0263743564841857,0.02939249845546,0.0327444050191508,0.0364642008889202,0.0405888367863042,0.0451581633132811,0.0502149629092945,0.0558049270948715,0.0619765642286397,0.0687810210842011,0.0762717998446725,0.0845043508278705,0.0935355206674962,0.103422836120974,0.114223605543923,0.125993823792326,0.138786872316122,0.152652014869948,0.167632700838843,0.183764702687538,0.20107413119122,0.219575391158068,0.23926916005748,0.260140490525381,0.282157152842917,0.305268342572692,0.32940387896313,0.354474009266413,0.380369911405365,0.406964952459608,0.434116714893458,0.461669749769182,0.489458961379804,0.517313476766029,0.545060812531805,0.572531125440989,0.599561325869222,0.625998845289431,0.651704878973986,0.676556969088374,0.700450845826559,0.723301499054599,0.745043504281639,0.765630670001935,0.78503510552149,0.803245828055111,0.820267035529077,0.836116168763182,0.850821875902556,0.864421975778112,0.876961497844548,0.888490856654731,0.899064200145336,0.90873795445173,0.917569574160844],"text":["Outcome category: outcome<br />Score:   0<br />Predicted risk: 0.0001607616","Outcome category: outcome<br />Score:   1<br />Predicted risk: 0.0001797120","Outcome category: outcome<br />Score:   2<br />Predicted risk: 0.0002008958","Outcome category: outcome<br />Score:   3<br />Predicted risk: 0.0002245762","Outcome category: outcome<br />Score:   4<br />Predicted risk: 0.0002510471","Outcome category: outcome<br />Score:   5<br />Predicted risk: 0.0002806372","Outcome category: outcome<br />Score:   6<br />Predicted risk: 0.0003137140","Outcome category: outcome<br />Score:   7<br />Predicted risk: 0.0003506879","Outcome category: outcome<br />Score:   8<br />Predicted risk: 0.0003920179","Outcome category: outcome<br />Score:   9<br />Predicted risk: 0.0004382166","Outcome category: outcome<br />Score:  10<br />Predicted risk: 0.0004898570","Outcome category: outcome<br />Score:  11<br />Predicted risk: 0.0005475796","Outcome category: outcome<br />Score:  12<br />Predicted risk: 0.0006120998","Outcome category: outcome<br />Score:  13<br />Predicted risk: 0.0006842170","Outcome category: outcome<br />Score:  14<br />Predicted risk: 0.0007648246","Outcome category: outcome<br />Score:  15<br />Predicted risk: 0.0008549204","Outcome category: outcome<br />Score:  16<br />Predicted risk: 0.0009556192","Outcome category: outcome<br />Score:  17<br />Predicted risk: 0.0010681665","Outcome category: outcome<br />Score:  18<br />Predicted risk: 0.0011939530","Outcome category: outcome<br />Score:  19<br />Predicted risk: 0.0013345323","Outcome category: outcome<br />Score:  20<br />Predicted risk: 0.0014916391","Outcome category: outcome<br />Score:  21<br />Predicted risk: 0.0016672103","Outcome category: outcome<br />Score:  22<br />Predicted risk: 0.0018634083","Outcome category: outcome<br />Score:  23<br />Predicted risk: 0.0020826468","Outcome category: outcome<br />Score:  24<br />Predicted risk: 0.0023276195","Outcome category: outcome<br />Score:  25<br />Predicted risk: 0.0026013322","Outcome category: outcome<br />Score:  26<br />Predicted risk: 0.0029071379","Outcome category: outcome<br />Score:  27<br />Predicted risk: 0.0032487762","Outcome category: outcome<br />Score:  28<br />Predicted risk: 0.0036304166","Outcome category: outcome<br />Score:  29<br />Predicted risk: 0.0040567067","Outcome category: outcome<br />Score:  30<br />Predicted risk: 0.0045328248","Outcome category: outcome<br />Score:  31<br />Predicted risk: 0.0050645387","Outcome category: outcome<br />Score:  32<br />Predicted risk: 0.0056582696","Outcome category: outcome<br />Score:  33<br />Predicted risk: 0.0063211632","Outcome category: outcome<br />Score:  34<br />Predicted risk: 0.0070611665","Outcome category: outcome<br />Score:  35<br />Predicted risk: 0.0078871126","Outcome category: outcome<br />Score:  36<br />Predicted risk: 0.0088088127","Outcome category: outcome<br />Score:  37<br />Predicted risk: 0.0098371561","Outcome category: outcome<br />Score:  38<br />Predicted risk: 0.0109842182","Outcome category: outcome<br />Score:  39<br />Predicted risk: 0.0122633769","Outcome category: outcome<br />Score:  40<br />Predicted risk: 0.0136894373","Outcome category: outcome<br />Score:  41<br />Predicted risk: 0.0152787635","Outcome category: outcome<br />Score:  42<br />Predicted risk: 0.0170494189","Outcome category: outcome<br />Score:  43<br />Predicted risk: 0.0190213117","Outcome category: outcome<br />Score:  44<br />Predicted risk: 0.0212163461","Outcome category: outcome<br />Score:  45<br />Predicted risk: 0.0236585755","Outcome category: outcome<br />Score:  46<br />Predicted risk: 0.0263743565","Outcome category: outcome<br />Score:  47<br />Predicted risk: 0.0293924985","Outcome category: outcome<br />Score:  48<br />Predicted risk: 0.0327444050","Outcome category: outcome<br />Score:  49<br />Predicted risk: 0.0364642009","Outcome category: outcome<br />Score:  50<br />Predicted risk: 0.0405888368","Outcome category: outcome<br />Score:  51<br />Predicted risk: 0.0451581633","Outcome category: outcome<br />Score:  52<br />Predicted risk: 0.0502149629","Outcome category: outcome<br />Score:  53<br />Predicted risk: 0.0558049271","Outcome category: outcome<br />Score:  54<br />Predicted risk: 0.0619765642","Outcome category: outcome<br />Score:  55<br />Predicted risk: 0.0687810211","Outcome category: outcome<br />Score:  56<br />Predicted risk: 0.0762717998","Outcome category: outcome<br />Score:  57<br />Predicted risk: 0.0845043508","Outcome category: outcome<br />Score:  58<br />Predicted risk: 0.0935355207","Outcome category: outcome<br />Score:  59<br />Predicted risk: 0.1034228361","Outcome category: outcome<br />Score:  60<br />Predicted risk: 0.1142236055","Outcome category: outcome<br />Score:  61<br />Predicted risk: 0.1259938238","Outcome category: outcome<br />Score:  62<br />Predicted risk: 0.1387868723","Outcome category: outcome<br />Score:  63<br />Predicted risk: 0.1526520149","Outcome category: outcome<br />Score:  64<br />Predicted risk: 0.1676327008","Outcome category: outcome<br />Score:  65<br />Predicted risk: 0.1837647027","Outcome category: outcome<br />Score:  66<br />Predicted risk: 0.2010741312","Outcome category: outcome<br />Score:  67<br />Predicted risk: 0.2195753912","Outcome category: outcome<br />Score:  68<br />Predicted risk: 0.2392691601","Outcome category: outcome<br />Score:  69<br />Predicted risk: 0.2601404905","Outcome category: outcome<br />Score:  70<br />Predicted risk: 0.2821571528","Outcome category: outcome<br />Score:  71<br />Predicted risk: 0.3052683426","Outcome category: outcome<br />Score:  72<br />Predicted risk: 0.3294038790","Outcome category: outcome<br />Score:  73<br />Predicted risk: 0.3544740093","Outcome category: outcome<br />Score:  74<br />Predicted risk: 0.3803699114","Outcome category: outcome<br />Score:  75<br />Predicted risk: 0.4069649525","Outcome category: outcome<br />Score:  76<br />Predicted risk: 0.4341167149","Outcome category: outcome<br />Score:  77<br />Predicted risk: 0.4616697498","Outcome category: outcome<br />Score:  78<br />Predicted risk: 0.4894589614","Outcome category: outcome<br />Score:  79<br />Predicted risk: 0.5173134768","Outcome category: outcome<br />Score:  80<br />Predicted risk: 0.5450608125","Outcome category: outcome<br />Score:  81<br />Predicted risk: 0.5725311254","Outcome category: outcome<br />Score:  82<br />Predicted risk: 0.5995613259","Outcome category: outcome<br />Score:  83<br />Predicted risk: 0.6259988453","Outcome category: outcome<br />Score:  84<br />Predicted risk: 0.6517048790","Outcome category: outcome<br />Score:  85<br />Predicted risk: 0.6765569691","Outcome category: outcome<br />Score:  86<br />Predicted risk: 0.7004508458","Outcome category: outcome<br />Score:  87<br />Predicted risk: 0.7233014991","Outcome category: outcome<br />Score:  88<br />Predicted risk: 0.7450435043","Outcome category: outcome<br />Score:  89<br />Predicted risk: 0.7656306700","Outcome category: outcome<br />Score:  90<br />Predicted risk: 0.7850351055","Outcome category: outcome<br />Score:  91<br />Predicted risk: 0.8032458281","Outcome category: outcome<br />Score:  92<br />Predicted risk: 0.8202670355","Outcome category: outcome<br />Score:  93<br />Predicted risk: 0.8361161688","Outcome category: outcome<br />Score:  94<br />Predicted risk: 0.8508218759","Outcome category: outcome<br />Score:  95<br />Predicted risk: 0.8644219758","Outcome category: outcome<br />Score:  96<br />Predicted risk: 0.8769614978","Outcome category: outcome<br />Score:  97<br />Predicted risk: 0.8884908567","Outcome category: outcome<br />Score:  98<br />Predicted risk: 0.8990642001","Outcome category: outcome<br />Score:  99<br />Predicted risk: 0.9087379545","Outcome category: outcome<br />Score: 100<br />Predicted risk: 0.9175695742"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"outcome","legendgroup":"outcome","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,100],"y":[0.000160761626476474,0.000179712031034194,0.000200895839693951,0.000224576158738925,0.000251047061730852,0.000280637227337393,0.000313714002763483,0.000350687942143996,0.000392017874869922,0.000438216565046196,0.000489857030176067,0.00054757959479765,0.00061209976323019,0.000684217004890703,0.000764824555888407,0.000854920351868366,0.00095561921943002,0.00106816646696101,0.00119395303046642,0.0013345323459925,0.00149163913758179,0.00166721032837019,0.00186340830243218,0.00208264676624271,0.00232761948104048,0.00260133216076123,0.00290713785427768,0.00324877615502836,0.00363041660517322,0.00405670668441435,0.00453282479454595,0.0050645386683183,0.00565826964359599,0.00632116324886896,0.00706116654116293,0.00788711261882795,0.00880881269525833,0.00983715606003304,0.0109842181648333,0.0122633769450486,0.0136894373149923,0.0152787635442536,0.0170494189223042,0.0190213117336812,0.021216346080824,0.023658575488479,0.0263743564841857,0.02939249845546,0.0327444050191508,0.0364642008889202,0.0405888367863042,0.0451581633132811,0.0502149629092945,0.0558049270948715,0.0619765642286397,0.0687810210842011,0.0762717998446725,0.0845043508278705,0.0935355206674962,0.103422836120974,0.114223605543923,0.125993823792326,0.138786872316122,0.152652014869948,0.167632700838843,0.183764702687538,0.20107413119122,0.219575391158068,0.23926916005748,0.260140490525381,0.282157152842917,0.305268342572692,0.32940387896313,0.354474009266413,0.380369911405365,0.406964952459608,0.434116714893458,0.461669749769182,0.489458961379804,0.517313476766029,0.545060812531805,0.572531125440989,0.599561325869222,0.625998845289431,0.651704878973986,0.676556969088374,0.700450845826559,0.723301499054599,0.745043504281639,0.765630670001935,0.78503510552149,0.803245828055111,0.820267035529077,0.836116168763182,0.850821875902556,0.864421975778112,0.876961497844548,0.888490856654731,0.917569574160844],"text":["Outcome category: outcome<br />Score:   0<br />Predicted risk: 0.0001607616","Outcome category: outcome<br />Score:   1<br />Predicted risk: 0.0001797120","Outcome category: outcome<br />Score:   2<br />Predicted risk: 0.0002008958","Outcome category: outcome<br />Score:   3<br />Predicted risk: 0.0002245762","Outcome category: outcome<br />Score:   4<br />Predicted risk: 0.0002510471","Outcome category: outcome<br />Score:   5<br />Predicted risk: 0.0002806372","Outcome category: outcome<br />Score:   6<br />Predicted risk: 0.0003137140","Outcome category: outcome<br />Score:   7<br />Predicted risk: 0.0003506879","Outcome category: outcome<br />Score:   8<br />Predicted risk: 0.0003920179","Outcome category: outcome<br />Score:   9<br />Predicted risk: 0.0004382166","Outcome category: outcome<br />Score:  10<br />Predicted risk: 0.0004898570","Outcome category: outcome<br />Score:  11<br />Predicted risk: 0.0005475796","Outcome category: outcome<br />Score:  12<br />Predicted risk: 0.0006120998","Outcome category: outcome<br />Score:  13<br />Predicted risk: 0.0006842170","Outcome category: outcome<br />Score:  14<br />Predicted risk: 0.0007648246","Outcome category: outcome<br />Score:  15<br />Predicted risk: 0.0008549204","Outcome category: outcome<br />Score:  16<br />Predicted risk: 0.0009556192","Outcome category: outcome<br />Score:  17<br />Predicted risk: 0.0010681665","Outcome category: outcome<br />Score:  18<br />Predicted risk: 0.0011939530","Outcome category: outcome<br />Score:  19<br />Predicted risk: 0.0013345323","Outcome category: outcome<br />Score:  20<br />Predicted risk: 0.0014916391","Outcome category: outcome<br />Score:  21<br />Predicted risk: 0.0016672103","Outcome category: outcome<br />Score:  22<br />Predicted risk: 0.0018634083","Outcome category: outcome<br />Score:  23<br />Predicted risk: 0.0020826468","Outcome category: outcome<br />Score:  24<br />Predicted risk: 0.0023276195","Outcome category: outcome<br />Score:  25<br />Predicted risk: 0.0026013322","Outcome category: outcome<br />Score:  26<br />Predicted risk: 0.0029071379","Outcome category: outcome<br />Score:  27<br />Predicted risk: 0.0032487762","Outcome category: outcome<br />Score:  28<br />Predicted risk: 0.0036304166","Outcome category: outcome<br />Score:  29<br />Predicted risk: 0.0040567067","Outcome category: outcome<br />Score:  30<br />Predicted risk: 0.0045328248","Outcome category: outcome<br />Score:  31<br />Predicted risk: 0.0050645387","Outcome category: outcome<br />Score:  32<br />Predicted risk: 0.0056582696","Outcome category: outcome<br />Score:  33<br />Predicted risk: 0.0063211632","Outcome category: outcome<br />Score:  34<br />Predicted risk: 0.0070611665","Outcome category: outcome<br />Score:  35<br />Predicted risk: 0.0078871126","Outcome category: outcome<br />Score:  36<br />Predicted risk: 0.0088088127","Outcome category: outcome<br />Score:  37<br />Predicted risk: 0.0098371561","Outcome category: outcome<br />Score:  38<br />Predicted risk: 0.0109842182","Outcome category: outcome<br />Score:  39<br />Predicted risk: 0.0122633769","Outcome category: outcome<br />Score:  40<br />Predicted risk: 0.0136894373","Outcome category: outcome<br />Score:  41<br />Predicted risk: 0.0152787635","Outcome category: outcome<br />Score:  42<br />Predicted risk: 0.0170494189","Outcome category: outcome<br />Score:  43<br />Predicted risk: 0.0190213117","Outcome category: outcome<br />Score:  44<br />Predicted risk: 0.0212163461","Outcome category: outcome<br />Score:  45<br />Predicted risk: 0.0236585755","Outcome category: outcome<br />Score:  46<br />Predicted risk: 0.0263743565","Outcome category: outcome<br />Score:  47<br />Predicted risk: 0.0293924985","Outcome category: outcome<br />Score:  48<br />Predicted risk: 0.0327444050","Outcome category: outcome<br />Score:  49<br />Predicted risk: 0.0364642009","Outcome category: outcome<br />Score:  50<br />Predicted risk: 0.0405888368","Outcome category: outcome<br />Score:  51<br />Predicted risk: 0.0451581633","Outcome category: outcome<br />Score:  52<br />Predicted risk: 0.0502149629","Outcome category: outcome<br />Score:  53<br />Predicted risk: 0.0558049271","Outcome category: outcome<br />Score:  54<br />Predicted risk: 0.0619765642","Outcome category: outcome<br />Score:  55<br />Predicted risk: 0.0687810211","Outcome category: outcome<br />Score:  56<br />Predicted risk: 0.0762717998","Outcome category: outcome<br />Score:  57<br />Predicted risk: 0.0845043508","Outcome category: outcome<br />Score:  58<br />Predicted risk: 0.0935355207","Outcome category: outcome<br />Score:  59<br />Predicted risk: 0.1034228361","Outcome category: outcome<br />Score:  60<br />Predicted risk: 0.1142236055","Outcome category: outcome<br />Score:  61<br />Predicted risk: 0.1259938238","Outcome category: outcome<br />Score:  62<br />Predicted risk: 0.1387868723","Outcome category: outcome<br />Score:  63<br />Predicted risk: 0.1526520149","Outcome category: outcome<br />Score:  64<br />Predicted risk: 0.1676327008","Outcome category: outcome<br />Score:  65<br />Predicted risk: 0.1837647027","Outcome category: outcome<br />Score:  66<br />Predicted risk: 0.2010741312","Outcome category: outcome<br />Score:  67<br />Predicted risk: 0.2195753912","Outcome category: outcome<br />Score:  68<br />Predicted risk: 0.2392691601","Outcome category: outcome<br />Score:  69<br />Predicted risk: 0.2601404905","Outcome category: outcome<br />Score:  70<br />Predicted risk: 0.2821571528","Outcome category: outcome<br />Score:  71<br />Predicted risk: 0.3052683426","Outcome category: outcome<br />Score:  72<br />Predicted risk: 0.3294038790","Outcome category: outcome<br />Score:  73<br />Predicted risk: 0.3544740093","Outcome category: outcome<br />Score:  74<br />Predicted risk: 0.3803699114","Outcome category: outcome<br />Score:  75<br />Predicted risk: 0.4069649525","Outcome category: outcome<br />Score:  76<br />Predicted risk: 0.4341167149","Outcome category: outcome<br />Score:  77<br />Predicted risk: 0.4616697498","Outcome category: outcome<br />Score:  78<br />Predicted risk: 0.4894589614","Outcome category: outcome<br />Score:  79<br />Predicted risk: 0.5173134768","Outcome category: outcome<br />Score:  80<br />Predicted risk: 0.5450608125","Outcome category: outcome<br />Score:  81<br />Predicted risk: 0.5725311254","Outcome category: outcome<br />Score:  82<br />Predicted risk: 0.5995613259","Outcome category: outcome<br />Score:  83<br />Predicted risk: 0.6259988453","Outcome category: outcome<br />Score:  84<br />Predicted risk: 0.6517048790","Outcome category: outcome<br />Score:  85<br />Predicted risk: 0.6765569691","Outcome category: outcome<br />Score:  86<br />Predicted risk: 0.7004508458","Outcome category: outcome<br />Score:  87<br />Predicted risk: 0.7233014991","Outcome category: outcome<br />Score:  88<br />Predicted risk: 0.7450435043","Outcome category: outcome<br />Score:  89<br />Predicted risk: 0.7656306700","Outcome category: outcome<br />Score:  90<br />Predicted risk: 0.7850351055","Outcome category: outcome<br />Score:  91<br />Predicted risk: 0.8032458281","Outcome category: outcome<br />Score:  92<br />Predicted risk: 0.8202670355","Outcome category: outcome<br />Score:  93<br />Predicted risk: 0.8361161688","Outcome category: outcome<br />Score:  94<br />Predicted risk: 0.8508218759","Outcome category: outcome<br />Score:  95<br />Predicted risk: 0.8644219758","Outcome category: outcome<br />Score:  96<br />Predicted risk: 0.8769614978","Outcome category: outcome<br />Score:  97<br />Predicted risk: 0.8884908567","Outcome category: outcome<br />Score: 100<br />Predicted risk: 0.9175695742"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":3.77952755905512,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"outcome","legendgroup":"outcome","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.9,0.9,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.900000000000002,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[2,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,90,91],"y":[0.00025,0.00025,0.0005,0.00025,0.0005,0.001,0.00025,0.001,0.00025,0.0015,0.0015,0.0005,0.00075,0.00175,0.002,0.003,0.00625,0.0055,0.00425,0.00275,0.01175,0.00425,0.00625,0.01675,0.01225,0.0085,0.01175,0.0145,0.01875,0.01675,0.0105,0.04175,0.00825,0.013,0.041,0.03025,0.03125,0.0285,0.016,0.0185,0.01925,0.024,0.08375,0.018,0.01875,0.01775,0.02725,0.024,0.041,0.026,0.03275,0.009,0.02025,0.02825,0.0195,0.0225,0.02675,0.0145,0.01025,0.01375,0.013,0.01525,0.009,0.0135,0.00575,0.00675,0.00625,0.0065,0.00675,0.002,0.00375,0.0045,0.00225,0.00175,0.00225,0.00075,0.0015,0.002,0.00125,0.00125,0.00075,0.00075,0.00025,0.00025,0.00025],"text":["Score:  2<br />Proportion: 0.00025","Score:  4<br />Proportion: 0.00025","Score:  8<br />Proportion: 0.00050","Score:  9<br />Proportion: 0.00025","Score: 10<br />Proportion: 0.00050","Score: 11<br />Proportion: 0.00100","Score: 12<br />Proportion: 0.00025","Score: 13<br />Proportion: 0.00100","Score: 14<br />Proportion: 0.00025","Score: 15<br />Proportion: 0.00150","Score: 16<br />Proportion: 0.00150","Score: 17<br />Proportion: 0.00050","Score: 18<br />Proportion: 0.00075","Score: 19<br />Proportion: 0.00175","Score: 20<br />Proportion: 0.00200","Score: 21<br />Proportion: 0.00300","Score: 22<br />Proportion: 0.00625","Score: 23<br />Proportion: 0.00550","Score: 24<br />Proportion: 0.00425","Score: 25<br />Proportion: 0.00275","Score: 26<br />Proportion: 0.01175","Score: 27<br />Proportion: 0.00425","Score: 28<br />Proportion: 0.00625","Score: 29<br />Proportion: 0.01675","Score: 30<br />Proportion: 0.01225","Score: 31<br />Proportion: 0.00850","Score: 32<br />Proportion: 0.01175","Score: 33<br />Proportion: 0.01450","Score: 34<br />Proportion: 0.01875","Score: 35<br />Proportion: 0.01675","Score: 36<br />Proportion: 0.01050","Score: 37<br />Proportion: 0.04175","Score: 38<br />Proportion: 0.00825","Score: 39<br />Proportion: 0.01300","Score: 40<br />Proportion: 0.04100","Score: 41<br />Proportion: 0.03025","Score: 42<br />Proportion: 0.03125","Score: 43<br />Proportion: 0.02850","Score: 44<br />Proportion: 0.01600","Score: 45<br />Proportion: 0.01850","Score: 46<br />Proportion: 0.01925","Score: 47<br />Proportion: 0.02400","Score: 48<br />Proportion: 0.08375","Score: 49<br />Proportion: 0.01800","Score: 50<br />Proportion: 0.01875","Score: 51<br />Proportion: 0.01775","Score: 52<br />Proportion: 0.02725","Score: 53<br />Proportion: 0.02400","Score: 54<br />Proportion: 0.04100","Score: 55<br />Proportion: 0.02600","Score: 56<br />Proportion: 0.03275","Score: 57<br />Proportion: 0.00900","Score: 58<br />Proportion: 0.02025","Score: 59<br />Proportion: 0.02825","Score: 60<br />Proportion: 0.01950","Score: 61<br />Proportion: 0.02250","Score: 62<br />Proportion: 0.02675","Score: 63<br />Proportion: 0.01450","Score: 64<br />Proportion: 0.01025","Score: 65<br />Proportion: 0.01375","Score: 66<br />Proportion: 0.01300","Score: 67<br />Proportion: 0.01525","Score: 68<br />Proportion: 0.00900","Score: 69<br />Proportion: 0.01350","Score: 70<br />Proportion: 0.00575","Score: 71<br />Proportion: 0.00675","Score: 72<br />Proportion: 0.00625","Score: 73<br />Proportion: 0.00650","Score: 74<br />Proportion: 0.00675","Score: 75<br />Proportion: 0.00200","Score: 76<br />Proportion: 0.00375","Score: 77<br />Proportion: 0.00450","Score: 78<br />Proportion: 0.00225","Score: 79<br />Proportion: 0.00175","Score: 80<br />Proportion: 0.00225","Score: 81<br />Proportion: 0.00075","Score: 82<br />Proportion: 0.00150","Score: 83<br />Proportion: 0.00200","Score: 84<br />Proportion: 0.00125","Score: 85<br />Proportion: 0.00125","Score: 86<br />Proportion: 0.00075","Score: 87<br />Proportion: 0.00075","Score: 88<br />Proportion: 0.00025","Score: 90<br />Proportion: 0.00025","Score: 91<br />Proportion: 0.00025"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(89,89,89,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x2","yaxis":"y2","hoverinfo":"text","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-5,105],"tickmode":"array","ticktext":["0","25","50","75","100"],"tickvals":[0,25,50,75,100],"categoryorder":"array","categoryarray":["0","25","50","75","100"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":15.9402241594022},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":true,"gridcolor":"rgba(229,229,229,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"Score","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"xaxis2":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-5,105],"tickmode":"array","ticktext":["0","25","50","75","100"],"tickvals":[0,25,50,75,100],"categoryorder":"array","categoryarray":["0","25","50","75","100"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":15.9402241594022},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":true,"gridcolor":"rgba(229,229,229,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y2","title":{"text":"Score","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis2":{"domain":[0,0.205714285714286],"automargin":true,"type":"linear","autorange":false,"range":[-0.0041875,0.0879375],"tickmode":"array","ticktext":["0.00","0.02","0.04","0.06","0.08"],"tickvals":[0,0.02,0.04,0.06,0.08],"categoryorder":"array","categoryarray":["0.00","0.02","0.04","0.06","0.08"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":15.9402241594022},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":true,"gridcolor":"rgba(229,229,229,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x2","title":{"text":"Proportion<br />of subjects","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0.365714285714286,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.05,1.05],"tickmode":"array","ticktext":["0.00","0.25","0.50","0.75","1.00"],"tickvals":[0,0.25,0.5,0.75,1],"categoryorder":"array","categoryarray":["0.00","0.25","0.50","0.75","1.00"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":15.9402241594022},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":true,"gridcolor":"rgba(229,229,229,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"Predicted risk","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"annotations":[],"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0.365714285714286,"y1":1},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":0.205714285714286}],"images":[],"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":44.4333748443338,"l":57.4512245745123},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Points indicate attainable final scores","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"attrs":{"114fa56cba9c":{"colour":{},"x":{},"y":{},"type":"scatter"},"114fa254f5a8c":{"colour":{},"x":{},"y":{}},"114fa475ede6a":{"x":{},"y":{},"type":"bar"}},"source":"A","config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<ul>
<li>You can also generate the <code>pred_score_train</code> based on training data for further analysis (e.g., conversion table based on the training data).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>pred_score_train <span class="ot">&lt;-</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">AutoScore_testing</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_set =</span> train_set,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">final_variables =</span> final_variables,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cut_vec =</span> cut_vec,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">scoring_table =</span> scoring_table,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="st">"best"</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">with_label =</span> <span class="cn">TRUE</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>***Performance using AutoScore:
AUC:  0.8358   95% CI: 0.8245-0.8471 (DeLong)
Best score threshold: &gt;= 58 
Other performance indicators based on this score threshold: 
Sensitivity: 0.7371 95% CI: 0.7113-0.762
Specificity: 0.7771 95% CI: 0.7698-0.7841
PPV:         0.2242 95% CI: 0.2161-0.2323
NPV:         0.9713 95% CI: 0.9685-0.974</code></pre>
</div>
</div>
<ul>
<li>Generate conversion table based on the training data based on predictive risk (i.e., probability of mortality based on logistic regression estimation) cut-off (e.g., 0.01, 0.05, 0.1, 0.2, 0.5) using <code>conversion_table()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">conversion_table</span>(<span class="at">pred_score =</span> pred_score_train, <span class="at">by =</span><span class="st">"risk"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 12%">
<col style="width: 11%">
<col style="width: 16%">
<col style="width: 11%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Predicted Risk [&gt;=]</th>
<th style="text-align: center;">Score cut-off [&gt;=]</th>
<th style="text-align: center;">Percentage of patients (%)</th>
<th style="text-align: center;">Accuracy (95% CI)</th>
<th style="text-align: center;">Sensitivity (95% CI)</th>
<th style="text-align: center;">Specificity (95% CI)</th>
<th style="text-align: center;">PPV (95% CI)</th>
<th style="text-align: center;">NPV (95% CI)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1%</td>
<td style="text-align: center;">38</td>
<td style="text-align: center;">80</td>
<td style="text-align: center;">27.6% (26.9-28.2%)</td>
<td style="text-align: center;">99.1% (98.5-99.6%)</td>
<td style="text-align: center;">21.3% (20.6-22%)</td>
<td style="text-align: center;">9.9% (9.8-10%)</td>
<td style="text-align: center;">99.6% (99.4-99.9%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">5%</td>
<td style="text-align: center;">52</td>
<td style="text-align: center;">43</td>
<td style="text-align: center;">62.8% (62-63.6%)</td>
<td style="text-align: center;">87.5% (85.4-89.3%)</td>
<td style="text-align: center;">60.7% (59.8-61.5%)</td>
<td style="text-align: center;">16.3% (15.9-16.7%)</td>
<td style="text-align: center;">98.2% (97.9-98.5%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">10%</td>
<td style="text-align: center;">59</td>
<td style="text-align: center;">24</td>
<td style="text-align: center;">79.2% (78.5-79.9%)</td>
<td style="text-align: center;">69.3% (66.4-71.8%)</td>
<td style="text-align: center;">80.1% (79.4-80.8%)</td>
<td style="text-align: center;">23.3% (22.4-24.3%)</td>
<td style="text-align: center;">96.8% (96.5-97%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">20%</td>
<td style="text-align: center;">65</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">87.9% (87.4-88.4%)</td>
<td style="text-align: center;">47.6% (44.8-50.4%)</td>
<td style="text-align: center;">91.4% (90.9-91.9%)</td>
<td style="text-align: center;">32.7% (30.9-34.6%)</td>
<td style="text-align: center;">95.2% (95-95.5%)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">50%</td>
<td style="text-align: center;">77</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">92.1% (91.9-92.3%)</td>
<td style="text-align: center;">11.1% (9.2-13.1%)</td>
<td style="text-align: center;">99.2% (99.1-99.4%)</td>
<td style="text-align: center;">55% (48.5-61.5%)</td>
<td style="text-align: center;">92.7% (92.6-92.9%)</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>the conversion table can also be visualized using an interactive figure.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_predicted_risk</span>(<span class="at">pred_score =</span> pred_score_train, <span class="at">max_score =</span> <span class="dv">100</span>, </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">final_variables =</span> final_variables, </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">scoring_table =</span> scoring_table, <span class="at">point_size =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-21c55904c8731af72de7" style="width:100%;height:464px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-21c55904c8731af72de7">{"x":{"data":[{"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.000121011445668118,0.000136109378433402,0.000153090708852912,0.000172190305666832,0.000193672306610684,0.00021783376050237,0.00024500872110801,0.000275572848449128,0.000309948579971334,0.000348610941545802,0.000392094076705549,0.000440998581921885,0.000495999746203123,0.000557856804955229,0.000627423330996759,0.00070565889998807,0.000793642183441098,0.000892585640046782,0.00100385199541655,0.00112897272160023,0.00126966875102113,0.00142787368484515,0.0016057597833279,0.0018057670553692,0.00203063579629108,0.00228344295659592,0.00256764275988995,0.00288711202484817,0.00324620068341615,0.00364978802448918,0.00410334522782963,0.00461300478529032,0.00518563743325937,0.00582893723869151,0.00655151548734165,0.00736300401200887,0.008274168564588,0.00929703277081275,0.0104450131012213,0.0117330651343851,0.0131778411646334,0.014797858899419,0.016613680581082,0.0186481013308994,0.0209263448236333,0.0234762635292482,0.026328539674099,0.0295168817453915,0.0330782097609112,0.0370528206276609,0.0414845227061943,0.0464207261888719,0.0519124731252275,0.0580143879620932,0.0647845264414117,0.0722840978179233,0.0805770329139411,0.0897293689142757,0.0998084215279612,0.110881716820282,0.123015659350647,0.136273920977817,0.15071554650419,0.166392788740708,0.183348706756648,0.201614586667082,0.221207273195185,0.242126530408505,0.264352578472685,0.28784397611693,0.312536031325903,0.338339921139202,0.365142681739442,0.392808190357079,0.421179201599656,0.450080426419464,0.479322558968538,0.508707074383465,0.538031549513665,0.567095208486315,0.595704372996884,0.62367750657114,0.650849581377033,0.677075559743155,0.702232861453024,0.726222771764776,0.748970823986775,0.770426256307618,0.79056069033628,0.809366206541397,0.826853000416255,0.843046795758511,0.857986172140349,0.871719936970504,0.884304642671795,0.895802319793826,0.906278469766259,0.915800337937672,0.92443546918494,0.932250534740203,0.939310409568707],"text":["Outcome category: outcome<br />Score:   0<br />Predicted risk: 0.0001210114","Outcome category: outcome<br />Score:   1<br />Predicted risk: 0.0001361094","Outcome category: outcome<br />Score:   2<br />Predicted risk: 0.0001530907","Outcome category: outcome<br />Score:   3<br />Predicted risk: 0.0001721903","Outcome category: outcome<br />Score:   4<br />Predicted risk: 0.0001936723","Outcome category: outcome<br />Score:   5<br />Predicted risk: 0.0002178338","Outcome category: outcome<br />Score:   6<br />Predicted risk: 0.0002450087","Outcome category: outcome<br />Score:   7<br />Predicted risk: 0.0002755728","Outcome category: outcome<br />Score:   8<br />Predicted risk: 0.0003099486","Outcome category: outcome<br />Score:   9<br />Predicted risk: 0.0003486109","Outcome category: outcome<br />Score:  10<br />Predicted risk: 0.0003920941","Outcome category: outcome<br />Score:  11<br />Predicted risk: 0.0004409986","Outcome category: outcome<br />Score:  12<br />Predicted risk: 0.0004959997","Outcome category: outcome<br />Score:  13<br />Predicted risk: 0.0005578568","Outcome category: outcome<br />Score:  14<br />Predicted risk: 0.0006274233","Outcome category: outcome<br />Score:  15<br />Predicted risk: 0.0007056589","Outcome category: outcome<br />Score:  16<br />Predicted risk: 0.0007936422","Outcome category: outcome<br />Score:  17<br />Predicted risk: 0.0008925856","Outcome category: outcome<br />Score:  18<br />Predicted risk: 0.0010038520","Outcome category: outcome<br />Score:  19<br />Predicted risk: 0.0011289727","Outcome category: outcome<br />Score:  20<br />Predicted risk: 0.0012696688","Outcome category: outcome<br />Score:  21<br />Predicted risk: 0.0014278737","Outcome category: outcome<br />Score:  22<br />Predicted risk: 0.0016057598","Outcome category: outcome<br />Score:  23<br />Predicted risk: 0.0018057671","Outcome category: outcome<br />Score:  24<br />Predicted risk: 0.0020306358","Outcome category: outcome<br />Score:  25<br />Predicted risk: 0.0022834430","Outcome category: outcome<br />Score:  26<br />Predicted risk: 0.0025676428","Outcome category: outcome<br />Score:  27<br />Predicted risk: 0.0028871120","Outcome category: outcome<br />Score:  28<br />Predicted risk: 0.0032462007","Outcome category: outcome<br />Score:  29<br />Predicted risk: 0.0036497880","Outcome category: outcome<br />Score:  30<br />Predicted risk: 0.0041033452","Outcome category: outcome<br />Score:  31<br />Predicted risk: 0.0046130048","Outcome category: outcome<br />Score:  32<br />Predicted risk: 0.0051856374","Outcome category: outcome<br />Score:  33<br />Predicted risk: 0.0058289372","Outcome category: outcome<br />Score:  34<br />Predicted risk: 0.0065515155","Outcome category: outcome<br />Score:  35<br />Predicted risk: 0.0073630040","Outcome category: outcome<br />Score:  36<br />Predicted risk: 0.0082741686","Outcome category: outcome<br />Score:  37<br />Predicted risk: 0.0092970328","Outcome category: outcome<br />Score:  38<br />Predicted risk: 0.0104450131","Outcome category: outcome<br />Score:  39<br />Predicted risk: 0.0117330651","Outcome category: outcome<br />Score:  40<br />Predicted risk: 0.0131778412","Outcome category: outcome<br />Score:  41<br />Predicted risk: 0.0147978589","Outcome category: outcome<br />Score:  42<br />Predicted risk: 0.0166136806","Outcome category: outcome<br />Score:  43<br />Predicted risk: 0.0186481013","Outcome category: outcome<br />Score:  44<br />Predicted risk: 0.0209263448","Outcome category: outcome<br />Score:  45<br />Predicted risk: 0.0234762635","Outcome category: outcome<br />Score:  46<br />Predicted risk: 0.0263285397","Outcome category: outcome<br />Score:  47<br />Predicted risk: 0.0295168817","Outcome category: outcome<br />Score:  48<br />Predicted risk: 0.0330782098","Outcome category: outcome<br />Score:  49<br />Predicted risk: 0.0370528206","Outcome category: outcome<br />Score:  50<br />Predicted risk: 0.0414845227","Outcome category: outcome<br />Score:  51<br />Predicted risk: 0.0464207262","Outcome category: outcome<br />Score:  52<br />Predicted risk: 0.0519124731","Outcome category: outcome<br />Score:  53<br />Predicted risk: 0.0580143880","Outcome category: outcome<br />Score:  54<br />Predicted risk: 0.0647845264","Outcome category: outcome<br />Score:  55<br />Predicted risk: 0.0722840978","Outcome category: outcome<br />Score:  56<br />Predicted risk: 0.0805770329","Outcome category: outcome<br />Score:  57<br />Predicted risk: 0.0897293689","Outcome category: outcome<br />Score:  58<br />Predicted risk: 0.0998084215","Outcome category: outcome<br />Score:  59<br />Predicted risk: 0.1108817168","Outcome category: outcome<br />Score:  60<br />Predicted risk: 0.1230156594","Outcome category: outcome<br />Score:  61<br />Predicted risk: 0.1362739210","Outcome category: outcome<br />Score:  62<br />Predicted risk: 0.1507155465","Outcome category: outcome<br />Score:  63<br />Predicted risk: 0.1663927887","Outcome category: outcome<br />Score:  64<br />Predicted risk: 0.1833487068","Outcome category: outcome<br />Score:  65<br />Predicted risk: 0.2016145867","Outcome category: outcome<br />Score:  66<br />Predicted risk: 0.2212072732","Outcome category: outcome<br />Score:  67<br />Predicted risk: 0.2421265304","Outcome category: outcome<br />Score:  68<br />Predicted risk: 0.2643525785","Outcome category: outcome<br />Score:  69<br />Predicted risk: 0.2878439761","Outcome category: outcome<br />Score:  70<br />Predicted risk: 0.3125360313","Outcome category: outcome<br />Score:  71<br />Predicted risk: 0.3383399211","Outcome category: outcome<br />Score:  72<br />Predicted risk: 0.3651426817","Outcome category: outcome<br />Score:  73<br />Predicted risk: 0.3928081904","Outcome category: outcome<br />Score:  74<br />Predicted risk: 0.4211792016","Outcome category: outcome<br />Score:  75<br />Predicted risk: 0.4500804264","Outcome category: outcome<br />Score:  76<br />Predicted risk: 0.4793225590","Outcome category: outcome<br />Score:  77<br />Predicted risk: 0.5087070744","Outcome category: outcome<br />Score:  78<br />Predicted risk: 0.5380315495","Outcome category: outcome<br />Score:  79<br />Predicted risk: 0.5670952085","Outcome category: outcome<br />Score:  80<br />Predicted risk: 0.5957043730","Outcome category: outcome<br />Score:  81<br />Predicted risk: 0.6236775066","Outcome category: outcome<br />Score:  82<br />Predicted risk: 0.6508495814","Outcome category: outcome<br />Score:  83<br />Predicted risk: 0.6770755597","Outcome category: outcome<br />Score:  84<br />Predicted risk: 0.7022328615","Outcome category: outcome<br />Score:  85<br />Predicted risk: 0.7262227718","Outcome category: outcome<br />Score:  86<br />Predicted risk: 0.7489708240","Outcome category: outcome<br />Score:  87<br />Predicted risk: 0.7704262563","Outcome category: outcome<br />Score:  88<br />Predicted risk: 0.7905606903","Outcome category: outcome<br />Score:  89<br />Predicted risk: 0.8093662065","Outcome category: outcome<br />Score:  90<br />Predicted risk: 0.8268530004","Outcome category: outcome<br />Score:  91<br />Predicted risk: 0.8430467958","Outcome category: outcome<br />Score:  92<br />Predicted risk: 0.8579861721","Outcome category: outcome<br />Score:  93<br />Predicted risk: 0.8717199370","Outcome category: outcome<br />Score:  94<br />Predicted risk: 0.8843046427","Outcome category: outcome<br />Score:  95<br />Predicted risk: 0.8958023198","Outcome category: outcome<br />Score:  96<br />Predicted risk: 0.9062784698","Outcome category: outcome<br />Score:  97<br />Predicted risk: 0.9158003379","Outcome category: outcome<br />Score:  98<br />Predicted risk: 0.9244354692","Outcome category: outcome<br />Score:  99<br />Predicted risk: 0.9322505347","Outcome category: outcome<br />Score: 100<br />Predicted risk: 0.9393104096"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"outcome","legendgroup":"outcome","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,100],"y":[0.000121011445668118,0.000136109378433402,0.000153090708852912,0.000172190305666832,0.000193672306610684,0.00021783376050237,0.00024500872110801,0.000275572848449128,0.000309948579971334,0.000348610941545802,0.000392094076705549,0.000440998581921885,0.000495999746203123,0.000557856804955229,0.000627423330996759,0.00070565889998807,0.000793642183441098,0.000892585640046782,0.00100385199541655,0.00112897272160023,0.00126966875102113,0.00142787368484515,0.0016057597833279,0.0018057670553692,0.00203063579629108,0.00228344295659592,0.00256764275988995,0.00288711202484817,0.00324620068341615,0.00364978802448918,0.00410334522782963,0.00461300478529032,0.00518563743325937,0.00582893723869151,0.00655151548734165,0.00736300401200887,0.008274168564588,0.00929703277081275,0.0104450131012213,0.0117330651343851,0.0131778411646334,0.014797858899419,0.016613680581082,0.0186481013308994,0.0209263448236333,0.0234762635292482,0.026328539674099,0.0295168817453915,0.0330782097609112,0.0370528206276609,0.0414845227061943,0.0464207261888719,0.0519124731252275,0.0580143879620932,0.0647845264414117,0.0722840978179233,0.0805770329139411,0.0897293689142757,0.0998084215279612,0.110881716820282,0.123015659350647,0.136273920977817,0.15071554650419,0.166392788740708,0.183348706756648,0.201614586667082,0.221207273195185,0.242126530408505,0.264352578472685,0.28784397611693,0.312536031325903,0.338339921139202,0.365142681739442,0.392808190357079,0.421179201599656,0.450080426419464,0.479322558968538,0.508707074383465,0.538031549513665,0.567095208486315,0.595704372996884,0.62367750657114,0.650849581377033,0.677075559743155,0.702232861453024,0.726222771764776,0.748970823986775,0.770426256307618,0.79056069033628,0.809366206541397,0.826853000416255,0.843046795758511,0.857986172140349,0.871719936970504,0.884304642671795,0.895802319793826,0.906278469766259,0.915800337937672,0.939310409568707],"text":["Outcome category: outcome<br />Score:   0<br />Predicted risk: 0.0001210114","Outcome category: outcome<br />Score:   1<br />Predicted risk: 0.0001361094","Outcome category: outcome<br />Score:   2<br />Predicted risk: 0.0001530907","Outcome category: outcome<br />Score:   3<br />Predicted risk: 0.0001721903","Outcome category: outcome<br />Score:   4<br />Predicted risk: 0.0001936723","Outcome category: outcome<br />Score:   5<br />Predicted risk: 0.0002178338","Outcome category: outcome<br />Score:   6<br />Predicted risk: 0.0002450087","Outcome category: outcome<br />Score:   7<br />Predicted risk: 0.0002755728","Outcome category: outcome<br />Score:   8<br />Predicted risk: 0.0003099486","Outcome category: outcome<br />Score:   9<br />Predicted risk: 0.0003486109","Outcome category: outcome<br />Score:  10<br />Predicted risk: 0.0003920941","Outcome category: outcome<br />Score:  11<br />Predicted risk: 0.0004409986","Outcome category: outcome<br />Score:  12<br />Predicted risk: 0.0004959997","Outcome category: outcome<br />Score:  13<br />Predicted risk: 0.0005578568","Outcome category: outcome<br />Score:  14<br />Predicted risk: 0.0006274233","Outcome category: outcome<br />Score:  15<br />Predicted risk: 0.0007056589","Outcome category: outcome<br />Score:  16<br />Predicted risk: 0.0007936422","Outcome category: outcome<br />Score:  17<br />Predicted risk: 0.0008925856","Outcome category: outcome<br />Score:  18<br />Predicted risk: 0.0010038520","Outcome category: outcome<br />Score:  19<br />Predicted risk: 0.0011289727","Outcome category: outcome<br />Score:  20<br />Predicted risk: 0.0012696688","Outcome category: outcome<br />Score:  21<br />Predicted risk: 0.0014278737","Outcome category: outcome<br />Score:  22<br />Predicted risk: 0.0016057598","Outcome category: outcome<br />Score:  23<br />Predicted risk: 0.0018057671","Outcome category: outcome<br />Score:  24<br />Predicted risk: 0.0020306358","Outcome category: outcome<br />Score:  25<br />Predicted risk: 0.0022834430","Outcome category: outcome<br />Score:  26<br />Predicted risk: 0.0025676428","Outcome category: outcome<br />Score:  27<br />Predicted risk: 0.0028871120","Outcome category: outcome<br />Score:  28<br />Predicted risk: 0.0032462007","Outcome category: outcome<br />Score:  29<br />Predicted risk: 0.0036497880","Outcome category: outcome<br />Score:  30<br />Predicted risk: 0.0041033452","Outcome category: outcome<br />Score:  31<br />Predicted risk: 0.0046130048","Outcome category: outcome<br />Score:  32<br />Predicted risk: 0.0051856374","Outcome category: outcome<br />Score:  33<br />Predicted risk: 0.0058289372","Outcome category: outcome<br />Score:  34<br />Predicted risk: 0.0065515155","Outcome category: outcome<br />Score:  35<br />Predicted risk: 0.0073630040","Outcome category: outcome<br />Score:  36<br />Predicted risk: 0.0082741686","Outcome category: outcome<br />Score:  37<br />Predicted risk: 0.0092970328","Outcome category: outcome<br />Score:  38<br />Predicted risk: 0.0104450131","Outcome category: outcome<br />Score:  39<br />Predicted risk: 0.0117330651","Outcome category: outcome<br />Score:  40<br />Predicted risk: 0.0131778412","Outcome category: outcome<br />Score:  41<br />Predicted risk: 0.0147978589","Outcome category: outcome<br />Score:  42<br />Predicted risk: 0.0166136806","Outcome category: outcome<br />Score:  43<br />Predicted risk: 0.0186481013","Outcome category: outcome<br />Score:  44<br />Predicted risk: 0.0209263448","Outcome category: outcome<br />Score:  45<br />Predicted risk: 0.0234762635","Outcome category: outcome<br />Score:  46<br />Predicted risk: 0.0263285397","Outcome category: outcome<br />Score:  47<br />Predicted risk: 0.0295168817","Outcome category: outcome<br />Score:  48<br />Predicted risk: 0.0330782098","Outcome category: outcome<br />Score:  49<br />Predicted risk: 0.0370528206","Outcome category: outcome<br />Score:  50<br />Predicted risk: 0.0414845227","Outcome category: outcome<br />Score:  51<br />Predicted risk: 0.0464207262","Outcome category: outcome<br />Score:  52<br />Predicted risk: 0.0519124731","Outcome category: outcome<br />Score:  53<br />Predicted risk: 0.0580143880","Outcome category: outcome<br />Score:  54<br />Predicted risk: 0.0647845264","Outcome category: outcome<br />Score:  55<br />Predicted risk: 0.0722840978","Outcome category: outcome<br />Score:  56<br />Predicted risk: 0.0805770329","Outcome category: outcome<br />Score:  57<br />Predicted risk: 0.0897293689","Outcome category: outcome<br />Score:  58<br />Predicted risk: 0.0998084215","Outcome category: outcome<br />Score:  59<br />Predicted risk: 0.1108817168","Outcome category: outcome<br />Score:  60<br />Predicted risk: 0.1230156594","Outcome category: outcome<br />Score:  61<br />Predicted risk: 0.1362739210","Outcome category: outcome<br />Score:  62<br />Predicted risk: 0.1507155465","Outcome category: outcome<br />Score:  63<br />Predicted risk: 0.1663927887","Outcome category: outcome<br />Score:  64<br />Predicted risk: 0.1833487068","Outcome category: outcome<br />Score:  65<br />Predicted risk: 0.2016145867","Outcome category: outcome<br />Score:  66<br />Predicted risk: 0.2212072732","Outcome category: outcome<br />Score:  67<br />Predicted risk: 0.2421265304","Outcome category: outcome<br />Score:  68<br />Predicted risk: 0.2643525785","Outcome category: outcome<br />Score:  69<br />Predicted risk: 0.2878439761","Outcome category: outcome<br />Score:  70<br />Predicted risk: 0.3125360313","Outcome category: outcome<br />Score:  71<br />Predicted risk: 0.3383399211","Outcome category: outcome<br />Score:  72<br />Predicted risk: 0.3651426817","Outcome category: outcome<br />Score:  73<br />Predicted risk: 0.3928081904","Outcome category: outcome<br />Score:  74<br />Predicted risk: 0.4211792016","Outcome category: outcome<br />Score:  75<br />Predicted risk: 0.4500804264","Outcome category: outcome<br />Score:  76<br />Predicted risk: 0.4793225590","Outcome category: outcome<br />Score:  77<br />Predicted risk: 0.5087070744","Outcome category: outcome<br />Score:  78<br />Predicted risk: 0.5380315495","Outcome category: outcome<br />Score:  79<br />Predicted risk: 0.5670952085","Outcome category: outcome<br />Score:  80<br />Predicted risk: 0.5957043730","Outcome category: outcome<br />Score:  81<br />Predicted risk: 0.6236775066","Outcome category: outcome<br />Score:  82<br />Predicted risk: 0.6508495814","Outcome category: outcome<br />Score:  83<br />Predicted risk: 0.6770755597","Outcome category: outcome<br />Score:  84<br />Predicted risk: 0.7022328615","Outcome category: outcome<br />Score:  85<br />Predicted risk: 0.7262227718","Outcome category: outcome<br />Score:  86<br />Predicted risk: 0.7489708240","Outcome category: outcome<br />Score:  87<br />Predicted risk: 0.7704262563","Outcome category: outcome<br />Score:  88<br />Predicted risk: 0.7905606903","Outcome category: outcome<br />Score:  89<br />Predicted risk: 0.8093662065","Outcome category: outcome<br />Score:  90<br />Predicted risk: 0.8268530004","Outcome category: outcome<br />Score:  91<br />Predicted risk: 0.8430467958","Outcome category: outcome<br />Score:  92<br />Predicted risk: 0.8579861721","Outcome category: outcome<br />Score:  93<br />Predicted risk: 0.8717199370","Outcome category: outcome<br />Score:  94<br />Predicted risk: 0.8843046427","Outcome category: outcome<br />Score:  95<br />Predicted risk: 0.8958023198","Outcome category: outcome<br />Score:  96<br />Predicted risk: 0.9062784698","Outcome category: outcome<br />Score:  97<br />Predicted risk: 0.9158003379","Outcome category: outcome<br />Score: 100<br />Predicted risk: 0.9393104096"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":3.77952755905512,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"outcome","legendgroup":"outcome","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.9,0.9,0.9,0.9,0.9,0.9,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.900000000000002,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[0,1,2,4,5,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,90,91,93,95],"y":[7.14285714285714e-05,0.000142857142857143,7.14285714285714e-05,7.14285714285714e-05,7.14285714285714e-05,7.14285714285714e-05,0.000142857142857143,0.000142857142857143,0.000357142857142857,0.000642857142857143,0.000714285714285714,0.0005,0.0005,0.00157142857142857,0.0015,0.0005,0.00221428571428571,0.00285714285714286,0.00221428571428571,0.003,0.00457142857142857,0.00428571428571429,0.0045,0.00242857142857143,0.00957142857142857,0.00378571428571429,0.00371428571428571,0.0187142857142857,0.0115714285714286,0.0095,0.0100714285714286,0.0151428571428571,0.015,0.0140714285714286,0.0115714285714286,0.0408571428571429,0.00821428571428571,0.0120714285714286,0.0377142857142857,0.0305,0.0283571428571429,0.0317142857142857,0.0173571428571429,0.0208571428571429,0.0169285714285714,0.0292857142857143,0.0823571428571429,0.018,0.0212857142857143,0.0165,0.028,0.0265,0.0436428571428571,0.0291428571428571,0.0311428571428571,0.00935714285714286,0.0254285714285714,0.0292142857142857,0.0168571428571429,0.0230714285714286,0.0247142857142857,0.0182857142857143,0.00971428571428571,0.0127857142857143,0.0158571428571429,0.0163571428571429,0.00828571428571429,0.0112857142857143,0.00492857142857143,0.0055,0.00707142857142857,0.00735714285714286,0.0065,0.00207142857142857,0.00285714285714286,0.00414285714285714,0.00235714285714286,0.00235714285714286,0.00207142857142857,0.00114285714285714,0.000642857142857143,0.0005,0.000642857142857143,0.000714285714285714,7.14285714285714e-05,0.000571428571428571,0.0005,0.000142857142857143,0.000214285714285714,7.14285714285714e-05,7.14285714285714e-05],"text":["Score:  0<br />Proportion: 7.142857e-05","Score:  1<br />Proportion: 1.428571e-04","Score:  2<br />Proportion: 7.142857e-05","Score:  4<br />Proportion: 7.142857e-05","Score:  5<br />Proportion: 7.142857e-05","Score:  7<br />Proportion: 7.142857e-05","Score:  8<br />Proportion: 1.428571e-04","Score:  9<br />Proportion: 1.428571e-04","Score: 10<br />Proportion: 3.571429e-04","Score: 11<br />Proportion: 6.428571e-04","Score: 12<br />Proportion: 7.142857e-04","Score: 13<br />Proportion: 5.000000e-04","Score: 14<br />Proportion: 5.000000e-04","Score: 15<br />Proportion: 1.571429e-03","Score: 16<br />Proportion: 1.500000e-03","Score: 17<br />Proportion: 5.000000e-04","Score: 18<br />Proportion: 2.214286e-03","Score: 19<br />Proportion: 2.857143e-03","Score: 20<br />Proportion: 2.214286e-03","Score: 21<br />Proportion: 3.000000e-03","Score: 22<br />Proportion: 4.571429e-03","Score: 23<br />Proportion: 4.285714e-03","Score: 24<br />Proportion: 4.500000e-03","Score: 25<br />Proportion: 2.428571e-03","Score: 26<br />Proportion: 9.571429e-03","Score: 27<br />Proportion: 3.785714e-03","Score: 28<br />Proportion: 3.714286e-03","Score: 29<br />Proportion: 1.871429e-02","Score: 30<br />Proportion: 1.157143e-02","Score: 31<br />Proportion: 9.500000e-03","Score: 32<br />Proportion: 1.007143e-02","Score: 33<br />Proportion: 1.514286e-02","Score: 34<br />Proportion: 1.500000e-02","Score: 35<br />Proportion: 1.407143e-02","Score: 36<br />Proportion: 1.157143e-02","Score: 37<br />Proportion: 4.085714e-02","Score: 38<br />Proportion: 8.214286e-03","Score: 39<br />Proportion: 1.207143e-02","Score: 40<br />Proportion: 3.771429e-02","Score: 41<br />Proportion: 3.050000e-02","Score: 42<br />Proportion: 2.835714e-02","Score: 43<br />Proportion: 3.171429e-02","Score: 44<br />Proportion: 1.735714e-02","Score: 45<br />Proportion: 2.085714e-02","Score: 46<br />Proportion: 1.692857e-02","Score: 47<br />Proportion: 2.928571e-02","Score: 48<br />Proportion: 8.235714e-02","Score: 49<br />Proportion: 1.800000e-02","Score: 50<br />Proportion: 2.128571e-02","Score: 51<br />Proportion: 1.650000e-02","Score: 52<br />Proportion: 2.800000e-02","Score: 53<br />Proportion: 2.650000e-02","Score: 54<br />Proportion: 4.364286e-02","Score: 55<br />Proportion: 2.914286e-02","Score: 56<br />Proportion: 3.114286e-02","Score: 57<br />Proportion: 9.357143e-03","Score: 58<br />Proportion: 2.542857e-02","Score: 59<br />Proportion: 2.921429e-02","Score: 60<br />Proportion: 1.685714e-02","Score: 61<br />Proportion: 2.307143e-02","Score: 62<br />Proportion: 2.471429e-02","Score: 63<br />Proportion: 1.828571e-02","Score: 64<br />Proportion: 9.714286e-03","Score: 65<br />Proportion: 1.278571e-02","Score: 66<br />Proportion: 1.585714e-02","Score: 67<br />Proportion: 1.635714e-02","Score: 68<br />Proportion: 8.285714e-03","Score: 69<br />Proportion: 1.128571e-02","Score: 70<br />Proportion: 4.928571e-03","Score: 71<br />Proportion: 5.500000e-03","Score: 72<br />Proportion: 7.071429e-03","Score: 73<br />Proportion: 7.357143e-03","Score: 74<br />Proportion: 6.500000e-03","Score: 75<br />Proportion: 2.071429e-03","Score: 76<br />Proportion: 2.857143e-03","Score: 77<br />Proportion: 4.142857e-03","Score: 78<br />Proportion: 2.357143e-03","Score: 79<br />Proportion: 2.357143e-03","Score: 80<br />Proportion: 2.071429e-03","Score: 81<br />Proportion: 1.142857e-03","Score: 82<br />Proportion: 6.428571e-04","Score: 83<br />Proportion: 5.000000e-04","Score: 84<br />Proportion: 6.428571e-04","Score: 85<br />Proportion: 7.142857e-04","Score: 86<br />Proportion: 7.142857e-05","Score: 87<br />Proportion: 5.714286e-04","Score: 88<br />Proportion: 5.000000e-04","Score: 90<br />Proportion: 1.428571e-04","Score: 91<br />Proportion: 2.142857e-04","Score: 93<br />Proportion: 7.142857e-05","Score: 95<br />Proportion: 7.142857e-05"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(89,89,89,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x2","yaxis":"y2","hoverinfo":"text","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-5,105],"tickmode":"array","ticktext":["0","25","50","75","100"],"tickvals":[0,25,50,75,100],"categoryorder":"array","categoryarray":["0","25","50","75","100"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":15.9402241594022},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":true,"gridcolor":"rgba(229,229,229,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"Score","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"xaxis2":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-5,105],"tickmode":"array","ticktext":["0","25","50","75","100"],"tickvals":[0,25,50,75,100],"categoryorder":"array","categoryarray":["0","25","50","75","100"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":15.9402241594022},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":true,"gridcolor":"rgba(229,229,229,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y2","title":{"text":"Score","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis2":{"domain":[0,0.205714285714286],"automargin":true,"type":"linear","autorange":false,"range":[-0.00411785714285714,0.086475],"tickmode":"array","ticktext":["0.00","0.02","0.04","0.06","0.08"],"tickvals":[0,0.02,0.04,0.06,0.08],"categoryorder":"array","categoryarray":["0.00","0.02","0.04","0.06","0.08"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":15.9402241594022},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":true,"gridcolor":"rgba(229,229,229,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x2","title":{"text":"Proportion<br />of subjects","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0.365714285714286,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.05,1.05],"tickmode":"array","ticktext":["0.00","0.25","0.50","0.75","1.00"],"tickvals":[0,0.25,0.5,0.75,1],"categoryorder":"array","categoryarray":["0.00","0.25","0.50","0.75","1.00"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":15.9402241594022},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":true,"gridcolor":"rgba(229,229,229,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"Predicted risk","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"annotations":[],"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0.365714285714286,"y1":1},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":0.205714285714286}],"images":[],"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":44.4333748443338,"l":57.4512245745123},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Points indicate attainable final scores","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"attrs":{"114fa2ed80137":{"colour":{},"x":{},"y":{},"type":"scatter"},"114fa6737d9e7":{"colour":{},"x":{},"y":{}},"114fa36dde978":{"x":{},"y":{},"type":"bar"}},"source":"A","config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<ul>
<li>Users could use the <code>pred_score</code> or <code>pred_score_train</code> for further analysis or export it as the CSV to other software (e.g., generating the calibration curve).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(pred_score, <span class="at">file =</span> <span class="st">"D:/pred_score.csv"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(pred_score_train, <span class="at">file =</span> <span class="st">"D:/pred_score_train.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="development-on-small-dataset-sample-size-1000-with-cross-validation" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="development-on-small-dataset-sample-size-1000-with-cross-validation"><span class="header-section-number">5.3</span> development on Small dataset (sample size = 1000) with cross-validation**</h2>
<p>In Demo #2, we demonstrate the use of AutoScore on a comparably small dataset where there are no sufficient samples to form a separate training and validation datasets. Thus, the cross validation is employed to generate the parsimony plot.</p>
<section id="get-small-dataset-with-1000-samples" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="get-small-dataset-with-1000-samples"><span class="header-section-number">5.3.1</span> Get small dataset with 1000 samples</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"sample_data_small"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prepare-training-and-test-datasets" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="prepare-training-and-test-datasets"><span class="header-section-number">5.3.2</span> Prepare training and test datasets</h3>
<ul>
<li>Option 1: Prepare two separate datasets to train and test models.</li>
<li>Option 2: Use demo codes below to randomly split your dataset into training and test datasets (70% and 30%, respectively). For cross-validation, <code>train_set</code> is equal to <code>validation_set</code> and the ratio of <code>validation_set</code> should be 0. Then cross-validation will be implemented in the STEP(ii) <code>AutoScore_parsimony()</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>out_split <span class="ot">&lt;-</span> <span class="fu">split_data</span>(<span class="at">data =</span> sample_data_small, <span class="at">ratio =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="dv">0</span>, <span class="fl">0.3</span>), <span class="at">cross_validation =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>train_set <span class="ot">&lt;-</span> out_split<span class="sc">$</span>train_set</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>validation_set <span class="ot">&lt;-</span> out_split<span class="sc">$</span>validation_set</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>test_set <span class="ot">&lt;-</span> out_split<span class="sc">$</span>test_set</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="stepi-generate-variable-ranking-list-autoscore-module-1-1" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3" class="anchored" data-anchor-id="stepi-generate-variable-ranking-list-autoscore-module-1-1"><span class="header-section-number">5.3.3</span> STEP(i): Generate variable ranking list (AutoScore Module 1)</h3>
<ul>
<li><code>method</code>: “rf” (default) or “auc”.</li>
</ul>
<p>method = <code>auc</code>: “auc” refers to the AUC-based ranking. For “auc”, univariate models will be built based on the train set, and the variable ranking is constructed via the AUC performance of corresponding univariate models on the validation set (<code>validation_set</code>).<br>
- <code>validation_set</code>: validation set required only if when <code>method</code> is “auc”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>ranking <span class="ot">&lt;-</span> <span class="fu">AutoScore_rank</span>(train_set, <span class="at">validation_set =</span> validation_set, <span class="at">ntree =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The ranking based on variable importance was shown below for each variable: 
      Age     Lab_B     Lab_H   Vital_E     Lab_K   Vital_A     Lab_I     Lab_J 
37.406648 31.315285 25.564054 21.855069 20.907522 20.645694 16.788696 16.094679 
  Vital_B     Lab_A     Lab_M   Vital_C   Vital_F     Lab_D     Lab_C     Lab_E 
15.574365 14.651987 14.297510 13.765633 12.932043 12.679113 12.295000 12.165724 
    Lab_F   Vital_D     Lab_L     Lab_G   Vital_G 
11.649415 11.431833 10.108408  9.297786  7.680821 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="04-autoscore_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>method = <code>rf</code>: “rf” refers to random forest-based ranking<br>
- <code>ntree</code>: Number of trees required only if when <code>method</code> is “rf” (Default: 100).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>ranking <span class="ot">&lt;-</span> <span class="fu">AutoScore_rank</span>(train_set, <span class="at">ntree =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The ranking based on variable importance was shown below for each variable: 
      Age     Lab_B     Lab_H     Lab_K   Vital_E   Vital_A     Lab_I     Lab_A 
33.661071 30.937904 25.129836 23.696395 20.572556 19.405187 16.609492 15.938134 
    Lab_J   Vital_C   Vital_B   Vital_F     Lab_M     Lab_C     Lab_D   Vital_D 
14.991216 14.839592 14.576851 14.465937 14.461607 13.750307 13.282037 13.245753 
    Lab_F     Lab_E     Lab_L     Lab_G   Vital_G 
12.097335 10.795598 10.617640  8.980531  6.903336 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="04-autoscore_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="stepii-select-the-best-model-with-parsimony-plot-autoscore-modules-234" class="level3" data-number="5.3.4">
<h3 data-number="5.3.4" class="anchored" data-anchor-id="stepii-select-the-best-model-with-parsimony-plot-autoscore-modules-234"><span class="header-section-number">5.3.4</span> STEP(ii): Select the best model with parsimony plot (AutoScore Modules 2+3+4)</h3>
<ul>
<li><code>nmin</code>: Minimum number of selected variables (Default: 1).</li>
<li><code>nmax</code>: Maximum number of selected variables (Default: 20).</li>
<li><code>categorize</code>: Methods for categorize continuous variables. Options include <code>"quantile"</code> or <code>"kmeans"</code> (Default: <code>"quantile"</code>).</li>
<li><code>quantiles</code>: Predefined quantiles to convert continuous variables to categorical ones. (Default: <code>c(0, 0.05, 0.2, 0.8, 0.95, 1)</code>) Available if <code>categorize = "quantile"</code>.</li>
<li><code>max_cluster</code>: The max number of cluster (Default: 5). Available if <code>categorize = "kmeans"</code>.</li>
<li><code>max_score</code> Maximum total score (Default: 100).</li>
<li><code>cross_validation</code> : <code>TRUE</code> if cross-validation is needed, especially for small datasets.</li>
<li><code>fold</code> The number of folds used in cross validation (Default: 10). Available if <code>cross_validation = TRUE</code>.</li>
<li><code>do_trace</code> If set to <code>TRUE</code>, all results based on each fold of cross-validation would be printed out and plotted (Default: <code>FALSE</code>). Available if <code>cross_validation = TRUE</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>AUC <span class="ot">&lt;-</span> <span class="fu">AutoScore_parsimony</span>(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    train_set,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    validation_set,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank =</span> ranking,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_score =</span> <span class="dv">100</span>,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_min =</span> <span class="dv">1</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_max =</span> <span class="dv">20</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cross_validation =</span> <span class="cn">TRUE</span>,</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">categorize =</span> <span class="st">"quantile"</span>,</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fold =</span> <span class="dv">10</span>,</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>), <span class="co">#c(0, 0.05, 0.2, 0.8, 0.95, 1)</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">do_trace =</span> <span class="cn">FALSE</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>***list of final mean AUC values through cross-validation are shown below 
   auc_set.sum
1    0.6396675
2    0.7231147
3    0.7315859
4    0.7457606
5    0.7624567
6    0.7669644
7    0.7703138
8    0.7642128
9    0.7665648
10   0.7713672
11   0.7674212
12   0.7664641
13   0.7584156
14   0.7558671
15   0.7629152
16   0.7636249
17   0.7689182
18   0.7656851
19   0.7625896
20   0.7593715</code></pre>
</div>
<div class="cell-output-display">
<p><img src="04-autoscore_files/figure-html/parsi-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Users could use the <code>AUC</code> for further analysis or export it as the CSV to other software for plotting.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">data.frame</span>(AUC), <span class="at">file =</span> <span class="st">"D:/AUC.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Determine the optimal number of variables (<code>num_var</code>) based on the parsimony plot obtained in STEP(ii).</li>
<li>The final list of variables is the first <code>num_var</code> variables in the ranked list <code>ranking</code> obtained in STEP(i).</li>
<li>Optional: User can adjust the finally included variables <code>final_variables</code> based on the clinical preferences and knowledge).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 1: Top 6 variables are selected</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>num_var <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>final_variables <span class="ot">&lt;-</span> <span class="fu">names</span>(ranking[<span class="dv">1</span><span class="sc">:</span>num_var])</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 2: Top 9 variables are selected</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>num_var <span class="ot">&lt;-</span> <span class="dv">9</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>final_variables <span class="ot">&lt;-</span> <span class="fu">names</span>(ranking[<span class="dv">1</span><span class="sc">:</span>num_var])</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 3: Top 6 variables, the 9th and 10th variable are selected</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>num_var <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>final_variables <span class="ot">&lt;-</span> <span class="fu">names</span>(ranking[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>num_var, <span class="dv">9</span>, <span class="dv">10</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="stepiii-generate-initial-scores-with-the-final-list-of-variables-re-run-autoscore-modules-23" class="level3" data-number="5.3.5">
<h3 data-number="5.3.5" class="anchored" data-anchor-id="stepiii-generate-initial-scores-with-the-final-list-of-variables-re-run-autoscore-modules-23"><span class="header-section-number">5.3.5</span> STEP(iii): Generate initial scores with the final list of variables (Re-run AutoScore Modules 2+3)</h3>
<ul>
<li>Generate <code>cut_vec</code> with current cutoffs of continuous variables, which can be fine-tuned in STEP(iv).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>cut_vec <span class="ot">&lt;-</span> <span class="fu">AutoScore_weighting</span>( </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    train_set,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    validation_set,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    final_variables,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_score =</span> <span class="dv">100</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">categorize =</span> <span class="st">"quantile"</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="fl">0.95</span>, <span class="dv">1</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>****Included Variables: 
  variable_name
1           Age
2         Lab_B
3         Lab_H
4         Lab_K
5       Vital_E
****Initial Scores: 


========  ===========  =====
variable  interval     point
========  ===========  =====
Age       &lt;35            0  
          [35,49)        1  
          [49,75)       13  
          [75,88)       21  
          &gt;=88          18  
                            
Lab_B     &lt;8.6           0  
          [8.6,11.3)     7  
          [11.3,17.5)   14  
          [17.5,19.8)   17  
          &gt;=19.8        14  
                            
Lab_H     &lt;1             0  
          [1,3.1)        8  
          [3.1,4.1)     14  
          &gt;=4.1         22  
                            
Lab_K     &lt;9             0  
          [9,43.2)       1  
          [43.2,59)      9  
          &gt;=59          13  
                            
Vital_E   &lt;12            0  
          [12,15)        7  
          [15,22)       11  
          [22,25)       16  
          &gt;=25          28  
========  ===========  =====</code></pre>
</div>
<div class="cell-output-display">
<p><img src="04-autoscore_files/figure-html/weighting2-1.png" class="img-fluid" width="480"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>***Performance (based on validation set):
AUC:  0.7891   95% CI: 0.7558-0.8224 (DeLong)
Best score threshold: &gt;= 48 
Other performance indicators based on this score threshold: 
Sensitivity: 0.706
Specificity: 0.7589
PPV:         0.7604
NPV:         0.7044
***The cutoffs of each variable generated by the AutoScore are saved in cut_vec. You can decide whether to revise or fine-tune them </code></pre>
</div>
</div>
</section>
<section id="stepiv-fine-tune-the-initial-score-generated-in-stepiii-autoscore-module-5-re-run-autoscore-modules-23-1" class="level3" data-number="5.3.6">
<h3 data-number="5.3.6" class="anchored" data-anchor-id="stepiv-fine-tune-the-initial-score-generated-in-stepiii-autoscore-module-5-re-run-autoscore-modules-23-1"><span class="header-section-number">5.3.6</span> STEP(iv): Fine-tune the initial score generated in STEP(iii) (AutoScore Module 5 &amp; Re-run AutoScore Modules 2+3)</h3>
<ul>
<li>Revise <code>cut_vec</code> with domain knowledge to update the scoring table (AutoScore Module 5).</li>
<li>Re-run AutoScore Modules 2+3 to generate the updated scores.</li>
<li>Users can choose any cutoff values and/or any number of categories, but are suggested to choose numbers close to the automatically determined values.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="do">## For example, we have current cutoffs of continuous variable:</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="do">## ==============  ===========  =====</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="do">## variable        interval     point</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="do">## ==============  ===========  =====</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lab_K           &lt;9             0  </span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                [9,43.2)       1  </span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                [43.2,59)      9  </span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                &gt;=59          13  </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Current cutoffs: <code>c(9, 43.2, 59)</code>. We can fine tune the cutoffs as follows:</li>
<li>Note: It is just a demo using simulated data, and thus, the result might not be clinically meaningful.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 1: rounding up to a nice number</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>cut_vec<span class="sc">$</span>Lab_K <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">45</span>, <span class="dv">60</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 2: changing cutoffs according to clinical knowledge or preference </span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>cut_vec<span class="sc">$</span>Lab_K <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">45</span>, <span class="dv">60</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 3: combining categories</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>cut_vec<span class="sc">$</span>Lab_K <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Then we do similar checks for other variables and update scoring table using new cutoffs if needed.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>cut_vec<span class="sc">$</span>Lab_H <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>cut_vec<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">35</span>, <span class="dv">50</span>, <span class="dv">80</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>cut_vec<span class="sc">$</span>Lab_B <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">18</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>cut_vec<span class="sc">$</span>Vital_E <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">22</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>scoring_table <span class="ot">&lt;-</span> <span class="fu">AutoScore_fine_tuning</span>(train_set,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>                        validation_set,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>                        final_variables,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>                        cut_vec,</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">max_score =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>***Fine-tuned Scores: 


========  ========  =====
variable  interval  point
========  ========  =====
Age       &lt;35         0  
          [35,50)     2  
          [50,80)    18  
          &gt;=80       23  
                         
Lab_B     &lt;8          0  
          [8,12)      8  
          [12,18)    15  
          &gt;=18       22  
                         
Lab_H     &lt;1          0  
          [1,2)      12  
          [2,3)      13  
          &gt;=3        18  
                         
Lab_K     &lt;45         0  
          [45,60)    10  
          &gt;=60       17  
                         
Vital_E   &lt;15         0  
          [15,22)    10  
          &gt;=22       20  
========  ========  =====</code></pre>
</div>
<div class="cell-output-display">
<p><img src="04-autoscore_files/figure-html/scoring2-1.png" class="img-fluid" width="480"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>***Performance (based on validation set, after fine-tuning):
AUC:  0.7623   95% CI: 0.7275-0.7971 (DeLong)
Best score threshold: &gt;= 60 
Other performance indicators based on this score threshold: 
Sensitivity: 0.5714
Specificity: 0.8214
PPV:         0.7761
NPV:         0.6389</code></pre>
</div>
</div>
</section>
<section id="stepv-evaluate-final-risk-scores-on-test-dataset-autoscore-module-6-1" class="level3" data-number="5.3.7">
<h3 data-number="5.3.7" class="anchored" data-anchor-id="stepv-evaluate-final-risk-scores-on-test-dataset-autoscore-module-6-1"><span class="header-section-number">5.3.7</span> STEP(v): Evaluate final risk scores on test dataset (AutoScore Module 6)</h3>
<ul>
<li><code>threshold</code>: Score threshold for the ROC analysis to generate sensitivity, specificity, etc. If set to <code>"best"</code>, the optimal threshold will be calculated (Default: <code>"best"</code>).</li>
<li><code>with_label</code>: Set to <code>TRUE</code> if there are labels in the <code>test_set</code> and performance will be evaluated accordingly (Default: <code>TRUE</code>).</li>
<li>Set the <code>with_label</code> to <code>FALSE</code> if there are not <code>label</code> in the <code>test_set</code> and the final predicted scores will be the output without performance evaluation.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>pred_score <span class="ot">&lt;-</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">AutoScore_testing</span>(</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    test_set,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    final_variables,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    cut_vec,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    scoring_table,</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="st">"best"</span>,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">with_label =</span> <span class="cn">TRUE</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-autoscore_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="480"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>***Performance using AutoScore:
AUC:  0.7133   95% CI: 0.6556-0.7709 (DeLong)
Best score threshold: &gt;= 51 
Other performance indicators based on this score threshold: 
Sensitivity: 0.7421 95% CI: 0.673-0.805
Specificity: 0.5887 95% CI: 0.5106-0.6667
PPV:         0.6707 95% CI: 0.621-0.7198
NPV:         0.6694 95% CI: 0.6043-0.7373</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pred_score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  pred_score Label
1         53  TRUE
2         56  TRUE
3         49  TRUE
4         38 FALSE
5         51  TRUE
6         40  TRUE</code></pre>
</div>
</div>
<ul>
<li>Use <code>print_roc_performance()</code> to generate the performance under different score thresholds (e.g., 90).</li>
<li>Note: It is just a demo using simulated data, and thus, the result might not be clinically meaningful.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print_roc_performance</span>(pred_score<span class="sc">$</span>Label, pred_score<span class="sc">$</span>pred_score, <span class="at">threshold =</span> <span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC:  0.7133   95% CI: 0.6556-0.7709 (DeLong)
Score threshold: &gt;= 90 
Other performance indicators based on this score threshold: 
Sensitivity: 0.0063
Specificity: 1
PPV:         1
NPV:         0.4716</code></pre>
</div>
</div>
</section>
<section id="stepvi-further-analysis-based-on-the-final-scoring-systems-e.g.-conversion-table-model-calibration-output-the-score" class="level3" data-number="5.3.8">
<h3 data-number="5.3.8" class="anchored" data-anchor-id="stepvi-further-analysis-based-on-the-final-scoring-systems-e.g.-conversion-table-model-calibration-output-the-score"><span class="header-section-number">5.3.8</span> STEP(vi): Further analysis based on the final scoring systems (e.g., conversion table, model calibration, output the score)</h3>
<ul>
<li><p>You can also generate conversion table using <code>conversion_table()</code>. Please refer to our. But we skipped it here.</p></li>
<li><p>Users could use the <code>pred_score</code> for further analysis or export it as the CSV to other software.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(pred_score, <span class="at">file =</span> <span class="st">"D:/pred_score.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="development-on-dataset-with-missing-values-informative-missing" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="development-on-dataset-with-missing-values-informative-missing"><span class="header-section-number">5.4</span> development on dataset with missing values (informative missing)**</h2>
<p>In Demo #3, we demonstrate the use of AutoScore on a dataset with missing values. AutoScore can automatically treat the missingness as a new category named <code>Unknown</code>. Please note that it is just a demo using simulated data, and thus, the result might not be clinically meaningful.</p>
<section id="load-package-and-data-1" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="load-package-and-data-1"><span class="header-section-number">5.4.1</span> load package and data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AutoScore)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"sample_data"</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sample_data)[<span class="fu">names</span>(sample_data) <span class="sc">==</span> <span class="st">"Mortality_inpatient"</span>] <span class="ot">&lt;-</span> <span class="st">"label"</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">check_data</span>(sample_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Your dataset doesn't have any missing values.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Data type check passed.</code></pre>
</div>
</div>
</section>
<section id="create-informative-missing" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="create-informative-missing"><span class="header-section-number">5.4.2</span> Create informative missing</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> AutoScore<span class="sc">:::</span><span class="fu">induce_informative_missing</span>(sample_data, <span class="at">vars_to_induce =</span> <span class="fu">names</span>(sample_data)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">prop_missing =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following steps are similar to Demo #1.</p>
<p>NOTE:</p>
<ul>
<li>High missing rate may cause the variable ranking less reliable, and thus, caution is needed for variable selection using parsimony plot.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>AUC <span class="ot">&lt;-</span> <span class="fu">AutoScore_parsimony</span>(</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    train_set,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    validation_set,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank =</span> ranking,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_score =</span> <span class="dv">100</span>,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_min =</span> <span class="dv">1</span>,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_max =</span> <span class="dv">20</span>,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">categorize =</span> <span class="st">"quantile"</span>,</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantiles =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="fl">0.95</span>, <span class="dv">1</span>),</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">auc_lim_min =</span> <span class="fl">0.5</span>,</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">auc_lim_max =</span> <span class="st">"adaptive"</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-autoscore_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>The <code>Unknown</code> category indicating the missingness will be displayed in the final scoring table.</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>***Fine-tuned Scores: 


========  =========  =====
variable  interval   point
========  =========  =====
Age       &lt;50          0  
          [50,75)     11  
          [75,90)     19  
          &gt;=90        23  
                          
Lab_H     &lt;0.2         0  
          [0.2,1)      6  
          [1,3)       10  
          [3,4)       18  
          &gt;=4         22  
                          
Lab_K     &lt;10          0  
          [10,40)      7  
          &gt;=40        14  
                          
Lab_B     &lt;10          0  
          [10,17)      3  
          &gt;=17         8  
                          
Vital_E   &lt;12          0  
          [12,15)      1  
          [15,22)      8  
          [22,25)     15  
          &gt;=25        18  
                          
Vital_A   &lt;59          2  
          [59,70)      0  
          [70,100)     8  
          [100,112)   14  
          &gt;=113       16  
          Unknown      7  
========  =========  =====</code></pre>
</div>
<div class="cell-output-display">
<p><img src="04-autoscore_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="480"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>***Performance (based on validation set, after fine-tuning):
AUC:  0.8185   95% CI: 0.7863-0.8507 (DeLong)
Best score threshold: &gt;= 54 
Other performance indicators based on this score threshold: 
Sensitivity: 0.8323
Specificity: 0.6575
PPV:         0.1695
NPV:         0.979</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="./03-data_processing.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data processing and checking</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./05-autoscore_survival.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">AutoScore for survival outcomes (AutoScore-Survival)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>